---
title: "Khadar Summer Scholar Program"
author: "E. Kaz Frick and S. Khadar"
date: "`r Sys.Date()`"
output:
  word_document:
    toc: true
  html_document:
    toc: true
    toc_float: true
    highlight: tango
    number_sections: false
    code_folding: show
    code_download: true
    df_print: paged
---

# Purpose

\ The purpose of this program is to teach the code for data analysis to a research student as part of their summer guided research experience. The research is conducted as part of a predoctoral dental student course, DENT6390.

\ Public License. 

# General Program Set up

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)
```

## R version and System Date

```{r version sysdate}
R.version.string
Sys.Date()
```

## Libraries

```{r library}
library(plyr)
library(tidyverse)
library(dplyr)
library(gt)
library(gtsummary)
library(broom)
library(knitr)
library(car)
library(epitools)
library(glue)
library(glm2)
library(ggfortify)
library(haven)
library(mosaic)
library(survey)
library(hexbin)
library(ggsurvey)
library(meta)
```

# Read in data

## Read in SAS files

```{r read 2019 sas}
read_sas("../MENTOR_DEMO/data/ed2019_sas.sas7bdat") -> df_2019
```

```{r read 2020 sas}
read_sas("../MENTOR_DEMO/data/ed2020_sas.sas7bdat") -> df_2020
```

```{r read 2021 sas}
read_sas("../MENTOR_DEMO/data/ed2021_sas.sas7bdat") -> df_2021
```

```{r read 2022 sas}
read_sas("../MENTOR_DEMO/data/ed2022_sas.sas7bdat") -> df_2022
```

```{r bind sas tables}
bind_rows(df_2019,df_2020,df_2021,df_2022,.id=NULL) -> combined_df
head(combined_df,9)
```

# Data Cleaning

## Select project vars

```{r select project vars}
select(
  combined_df,
  YEAR,
  HOSPCODE,
  PATCODE,
  DIAG1,
  DIAG2,
  REGION,
  MSA,
  RESIDNCE,
  SEX,
  AGER,
  AGE,
  RACERETH,
  PAYTYPER,
  SEEN72,
  contains("DIABTYP"),
  SUBSTAB,
  NUMMED,
  starts_with("MED"),
  INJURY,
  PATWT,
  CPSUM,
  CSTRATM) -> df_select
tail(df_select,10)
```

## Create new vectors

```{r vector geo}
df_select %>%
  mutate(
    geo_strata =
      case_when(
        REGION == 1 & MSA == 1 ~ "NE MSA",
        REGION == 1 & MSA == 2 ~ "NE non-MSA",
        REGION == 2 & MSA == 1 ~ "MW MSA",
        REGION == 2 & MSA == 2 ~ "MW non-MSA",
        REGION == 3 & MSA == 1 ~ "S MSA",
        REGION == 3 & MSA == 2 ~ "S non-MSA",
        REGION == 4 & MSA == 1 ~ "W MSA",
        REGION == 4 & MSA == 2 ~ "W non-MSA",
        .default = NULL
      )
  ) -> df_select_factored
tail(df_select_factored, 10)
```

```{r vector ntdc}
list_ntdc_codes <- c('K029',
                     'K03-',
                     'K038',
                     'K04-',
                     'K040',
                     'K047',
                     'K05-',
                     'K050',
                     'K051',
                     'K055',
                     'K056',
                     'K069',
                     'K08-',
                     'K088',
                     'K089',
                     'K122')
df_select_factored %>%
  mutate(
    ntdc=
      case_when(
        INJURY != 1 & DIAG1 %in% list_ntdc_codes |
        INJURY != 1 & DIAG2 %in% list_ntdc_codes ~ 1,
        .default = 0
      )
  ) -> df_select_factored
tail(df_select_factored, 10)
```

```{r vector diabetes}
df_select_factored %>%
  mutate(
    diab_status=case_when(
      DIABTYP1 == "1" | DIABTYP2 == "1" | DIABTYP0 == "1" ~ "Yes",
      DIABTYP1 == "0" & DIABTYP2 == "0" & DIABTYP0 == "0" ~ "No",
      is.na(DIABTYP1) & is.na(DIABTYP2) & is.na(DIABTYP0) ~ "Unknown",
      TRUE ~ "Other")
  ) -> df_select_factored
tail(df_select_factored,10)
```

```{r vector opioid}
list_opioid <- c('98036',
                  '96041',
                  '12046',
                  '00280',
                  '12028',
                  '19650',
                  '14955',
                  '95050',
                  '96028',
                  '32930',
                  '09600',
                  '15005',
                  '22305',
                  '89039',
                  '03319',
                  '02333',
                  '22303')
df_select_factored %>%
  mutate(
    rx_opioid=
      case_when(
        MED1 %in% list_opioid |
        MED2 %in% list_opioid |
        MED3 %in% list_opioid |
        MED4 %in% list_opioid |
        MED5 %in% list_opioid |
        MED6 %in% list_opioid |
        MED7 %in% list_opioid |
        MED8 %in% list_opioid |
        MED9 %in% list_opioid |
        MED10 %in% list_opioid |
        MED11 %in% list_opioid |
        MED12 %in% list_opioid ~ "Yes",
        .default = "No"
      )
  ) -> df_select_factored
tail(df_select_factored, 5)
```

```{r vector analgesic}
list_nsaid_ace <- c('15395',
                    '92161',
                    '93220',
                    '19675',
                    '20290',
                    '20285',
                    '34725',
                    '92116',
                    '00169',
                    '00597',
                    '03381',
                    '00048',
                    '32905',
                    '00260',
                    '32920')
df_select_factored %>%
  mutate(
    rx_nsaid_ace=
      case_when(
        MED1 %in% list_nsaid_ace |
        MED2 %in% list_nsaid_ace |
        MED3 %in% list_nsaid_ace |
        MED4 %in% list_nsaid_ace |
        MED5 %in% list_nsaid_ace |
        MED6 %in% list_nsaid_ace |
        MED7 %in% list_nsaid_ace |
        MED8 %in% list_nsaid_ace |
        MED9 %in% list_nsaid_ace |
        MED10 %in% list_nsaid_ace |
        MED11 %in% list_nsaid_ace |
        MED12 %in% list_nsaid_ace ~ "Yes",
        .default = "No"
      )
  ) -> df_select_factored
tail(df_select_factored,5)
```

```{r vector antibiotic}
list_antibiotic <- c('01044',
                      '06920',
                      '01630',
                      '60115',
                      '06905',
                      '23215',
                      '23228',
                      '33780',
                      '03081',
                      '01640',
                      '23230',
                      '61295',
                      '89018',
                      '16136',
                      '06125',
                      '16475',
                      '23225',
                      '10355',
                      '61160',
                      '01053',
                      '01635',
                      '05995',
                      '06839',
                      '19233',
                      '19290',
                      '23221',
                      '93179',
                      '95149',
                      '99014',
                      '03283',
                      '91069',
                      '01685')
df_select_factored %>%
  mutate(
    rx_antibiotic=
      case_when(
        MED1 %in% list_antibiotic |
        MED2 %in% list_antibiotic |
        MED3 %in% list_antibiotic |
        MED4 %in% list_antibiotic |
        MED5 %in% list_antibiotic |
        MED6 %in% list_antibiotic |
        MED7 %in% list_antibiotic |
        MED8 %in% list_antibiotic |
        MED9 %in% list_antibiotic |
        MED10 %in% list_antibiotic |
        MED11 %in% list_antibiotic |
        MED12 %in% list_antibiotic ~ "Yes",
        .default = "No"
      )
  ) -> df_select_factored
tail(df_select_factored,5)
```

### Factors

```{r factors}
df_select_factored |>
  mutate(
    Year=
      factor(
        YEAR,
        levels=c("2019","2020","2021","2022"),
        labels=c("2019","2020","2021","2022")
      )
  ) |>
  mutate(
    ntdc_f=
      factor(
        ntdc,
        levels=0:1,
        labels=c("No", "Yes")
      )
  ) |>
  mutate(
    DentalVisit=
      factor(
        ntdc,
        levels=0:1,
        labels=c("All Others", "Dental Visits")
      )
  ) |>
  mutate(
    region_f=
      factor(
        REGION, 
        levels=1:4,
        labels=c("Northeast", "Midwest", "South", "West")
       )
  ) |>
  mutate(
    Region=
      factor(
        REGION, 
        levels=1:4,
        labels=c("NE", "MW", "S", "W")
       )
  ) |>
  mutate(
    msa_f=
      factor(
        MSA,
        levels=1:2,
        labels=c("MSA", "Non-MSA")
      )
  ) |>
  mutate(
    Metro=
      factor(
        MSA,
        levels=1:2,
        labels=c("Metro", "Non-Metro")
      )
  ) |>
  mutate(
    sex_f=
      factor(
        SEX,
        levels=1:2,
        labels=c("Female","Male")
      )
  ) |>
   mutate(
    Sex=
      factor(
        SEX,
        levels=1:2,
        labels=c("Female","Male")
      )
  ) |>
  mutate(
    ager_f=
      factor(
        AGER,
        levels=1:6,
        labels=c("<15yr", 
                 "15-24yr", 
                 "25-44yr", 
                 "45-64yr",
                 "65-74yr",
                 "75+yr")
        )
    ) |>
 mutate(
    Age=
      factor(
        AGER,
        levels=1:6,
        labels=c("<15", 
                 "15-24", 
                 "25-44", 
                 "45-64",
                 "65+",
                 "65+")
        )
    ) |>  
  mutate(
    racereth_f=
      factor(
        RACERETH,
        levels=1:4,
        labels=c("Non-Hispanic White",
                 "Non-Hispanic Black",
                 "Hispanic",
                 "Non-Hispanic Other")
      )
  ) |>
  mutate(
    RaceEth=
      factor(
        RACERETH,
        levels=1:4,
        labels=c("White",
                 "Black",
                 "Hisp.",
                 "Other")
      )
  ) |>
  mutate(
    substab_f=
      factor(
        SUBSTAB,
        levels=0:1,
        labels=c("No","Yes")
        )
  ) |>
  mutate(
    PayerType=
      factor(
        PAYTYPER,
        levels=c(-9,-8,1,2,3,4,5,6,7),
        labels=c("Other",
                 "Other",
                 "Private",
                 "Medicare",
                 "State",
                 "Other",
                 "Self",
                 "Other",
                 "Other")
      )
  ) |>
  mutate(
    paytyper_f=
      factor(
        PAYTYPER,
        levels=c(-9,-8,1,2,3,4,5,6,7),
        labels=c("Other",
                 "Other",
                 "Private",
                 "Medicare",
                 "State Program",
                 "Other",
                 "Self-pay",
                 "Other",
                 "Other")
      )
  ) |>
  mutate(
    ResidenceType=
      factor(
        RESIDNCE,
        levels=c(-9,-8,1,2,3,4),
        labels=c("Unknown",
                 "Unknown",
                 "Private",
                 "Other",
                 "Other",
                 "Unknown")
      )
  ) |>
  mutate(
    residnce_f=
      factor(
        RESIDNCE,
        levels=c(-9,-8,1,2,3,4),
        labels=c("Unspecified",
                 "Unspecified",
                 "Private",
                 "Nursing Home",
                 "Homeless",
                 "Unspecified")
      )
  ) |>
  mutate(
    seen72_f=
      factor(
        SEEN72,
        levels=c(-9,-8,1,2),
        labels=c("Unspecified",
                 "Unspecified",
                 "Yes",
                 "No")
      )
  ) -> df_select_factored 
tail(df_select_factored,5)
```

```{r check distinct values}
n_distinct(df_select_factored$geo_strata)
n_distinct(df_select_factored$ntdc)
n_distinct(df_select_factored$diab_status)
n_distinct(df_select_factored$rx_opioid)
n_distinct(df_select_factored$rx_nsaid_ace)
n_distinct(df_select_factored$rx_antibiotic)
```

# Set Reference Levels

```{r ref levels}
within(
  df_select_factored, 
    residnce_lvl <- relevel(ResidenceType, ref="Private"))-> df_ref
within(
    df_ref, 
      ager_lvl <- relevel(Age, ref = "45-64")) -> df_ref
within(
    df_ref, 
      paytyper_lvl <- relevel(PayerType, ref="Private")) -> df_ref
within(
    df_ref, 
      region_lvl <- relevel(region_f, ref="South")) -> df_ref
```

# Survey Design

## Survey Design Object

```{r survey design object}
survey_design <- svydesign(id = ~CPSUM,
                           weights = ~PATWT,
                           strata = ~CSTRATM,
                           nest = TRUE,
                           survey.lonely.psu = "fail",
                           data = df_select_factored)
summary(survey_design)
```

### Survey Design + Ref Levels

```{r survey design object with ref}
survey_design_ref <- svydesign(id = ~CPSUM,
                           weights = ~PATWT,
                           strata = ~CSTRATM,
                           nest = TRUE,
                           survey.lonely.psu = "fail",
                           data = df_ref)
```

## Survey Design Subset

### Subset by Region

```{r survey design subset region1}
survey_design_subset_r1 <- subset(survey_design_ref,
                                    REGION == 1)
summary(survey_design_subset_r1)
```

```{r survey design subset region2}
survey_design_subset_r2 <- subset(survey_design_ref,
                                    REGION == 2)
```

```{r survey design subset region3}
survey_design_subset_r3 <- subset(survey_design_ref,
                                    REGION == 3)
```


```{r survey design subset region4}
survey_design_subset_r4 <- subset(survey_design_ref,
                                    REGION == 4)
```

### Subset by MSA

```{r survey design subset MSA1}
survey_design_subset_m1 <- subset(survey_design_ref,
                                    MSA == 1)
```

```{r survey design subset MSA2}
survey_design_subset_m2 <- subset(survey_design_ref,
                                    MSA == 2)
```

### Subset by NTDC

```{r survey design subset ntdc}
survey_design_subset_ntdc <- subset(survey_design_ref,
                                    ntdc == "1")
```

### Subset by Non-case

```{r survey design subset noncase}
survey_design_subset_noncase <- subset(survey_design_ref,
                                    ntdc == "0")
```

### Subset by Geographic Strata

#### G1

```{r survey design subset geo1}
survey_design_subset_geo1 <- subset(survey_design_ref,
                                    geo_strata == "NE MSA")
```

```{r survey design subset g1d}
survey_design_subset_g1_dent <- subset(survey_design_ref,
                                    geo_strata == "NE MSA" & ntdc=="1")
```

```{r survey design subset g1n}
survey_design_subset_g1_non <- subset(survey_design_ref,
                                    geo_strata == "NE MSA" & ntdc=="0")
```

#### G2

```{r survey design subset geo2}
survey_design_subset_geo2 <- subset(survey_design_ref,
                                    geo_strata == "NE non-MSA")
```

```{r survey design subset g2d}
survey_design_subset_g2_dent <- subset(survey_design_ref,
                                    geo_strata == "NE non-MSA" & ntdc=="1")
```

```{r survey design subset g2n}
survey_design_subset_g2_non <- subset(survey_design_ref,
                                    geo_strata == "NE non-MSA" & ntdc=="0")
```

#### G3

```{r survey design subset geo3}
survey_design_subset_geo3 <- subset(survey_design_ref,
                                    geo_strata == "MW MSA")
```

```{r survey design subset g3d}
survey_design_subset_g3_dent <- subset(survey_design_ref,
                                    geo_strata == "MW MSA" & ntdc=="1")
```

```{r survey design subset g3n}
survey_design_subset_g3_non <- subset(survey_design_ref,
                                    geo_strata == "MW MSA" & ntdc=="0")
```

#### G4

```{r survey design subset geo4}
survey_design_subset_geo4 <- subset(survey_design_ref,
                                    geo_strata == "MW non-MSA")
```

```{r survey design subset g4d}
survey_design_subset_g4_dent <- subset(survey_design_ref,
                                    geo_strata == "MW non-MSA" & ntdc=="1")
```

```{r survey design subset g4n}
survey_design_subset_g4_non <- subset(survey_design_ref,
                                    geo_strata == "MW non-MSA" & ntdc=="0")
```

#### G5

```{r survey design subset geo5}
survey_design_subset_geo5 <- subset(survey_design_ref,
                                    geo_strata == "S MSA")
```     

```{r survey design subset 5d}
survey_design_subset_g5_dent <- subset(survey_design_ref,
                                    geo_strata == "S MSA" & ntdc=="1")
```

```{r survey design subset g5n}
survey_design_subset_g5_non <- subset(survey_design_ref,
                                    geo_strata == "S MSA" & ntdc=="0")
```


#### G6

```{r survey design subset geo6}
survey_design_subset_geo6 <- subset(survey_design_ref,
                                    geo_strata == "S non-MSA")
```

```{r survey design subset g6d}
survey_design_subset_g6_dent <- subset(survey_design_ref,
                                    geo_strata == "S non-MSA" & ntdc=="1")
```

```{r survey design subset g6n}
survey_design_subset_g6_non <- subset(survey_design_ref,
                                    geo_strata == "S non-MSA" & ntdc=="0")
```

#### G7

```{r survey design subset geo7}
survey_design_subset_geo7 <- subset(survey_design_ref,
                                    geo_strata == "W MSA")
```

```{r survey design subset g7d}
survey_design_subset_g7_dent <- subset(survey_design_ref,
                                    geo_strata == "W MSA" & ntdc=="1")
```

```{r survey design subset g7n}
survey_design_subset_g7_non <- subset(survey_design_ref,
                                    geo_strata == "W MSA" & ntdc=="0")
```

#### G8

```{r survey design subset geo8}
survey_design_subset_geo8 <- subset(survey_design_ref,
                                    geo_strata == "W non-MSA")
```

```{r survey design subset g8d}
survey_design_subset_g8_dent <- subset(survey_design_ref,
                                    geo_strata == "W non-MSA" & ntdc=="1")
```

```{r survey design subset g8n}
survey_design_subset_g8_non <- subset(survey_design_ref,
                                    geo_strata == "W non-MSA" & ntdc=="0")
```

# Descriptives

## General Counts and Proportions

### NTDC/DentalVist

```{r counts ntdc}
svytotal(~DentalVisit,design=survey_design_ref,na.rm=FALSE)
```

```{r prop ntdc}
svyciprop(~I(DentalVisit=="All Others"),survey_design_ref,method="lo")
svyciprop(~I(DentalVisit=="Dental Visits"),survey_design_ref,method="lo")
```

### geo_strata

```{r counts geo total sample}
svytotal(~geo_strata,design=survey_design_ref,na.rm=FALSE)
```

```{r prop geo total sample}
svyciprop(~I(geo_strata=="MW MSA"),survey_design_ref,method="lo")
svyciprop(~I(geo_strata=="MW non-MSA"),survey_design_ref,method="lo")
svyciprop(~I(geo_strata=="NE MSA"),survey_design_ref,method="lo")
svyciprop(~I(geo_strata=="NE non-MSA"),survey_design_ref,method="lo")
svyciprop(~I(geo_strata=="S MSA"),survey_design_ref,method="lo")
svyciprop(~I(geo_strata=="S non-MSA"),survey_design_ref,method="lo")
svyciprop(~I(geo_strata=="W MSA"),survey_design_ref,method="lo")
svyciprop(~I(geo_strata=="W non-MSA"),survey_design_ref,method="lo")
```

## Case & Total Counts & Proportions, Weighted

### geo_strata

```{r counts geo subset ntdc}
svytotal(~geo_strata,design=survey_design_subset_ntdc,na.rm=FALSE)
```

```{r prop geo subset ntdc}
svyciprop(~I(geo_strata=="MW MSA"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(geo_strata=="MW non-MSA"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(geo_strata=="NE MSA"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(geo_strata=="NE non-MSA"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(geo_strata=="S MSA"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(geo_strata=="S non-MSA"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(geo_strata=="W MSA"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(geo_strata=="W non-MSA"),survey_design_subset_ntdc,method="lo")
```

### Age

```{r counts Age all}
svytotal(~Age,design=survey_design_ref,na.rm=FALSE)
```

```{r counts Age subset ntdc}
svytotal(~Age,design=survey_design_subset_ntdc,na.rm=FALSE)
```

```{r prop Age all}
svyciprop(~I(Age=="<15"),survey_design_ref,method="lo")
svyciprop(~I(Age=="15-24"),survey_design_ref,method="lo")
svyciprop(~I(Age=="25-44"),survey_design_ref,method="lo")
svyciprop(~I(Age=="45-64"),survey_design_ref,method="lo")
svyciprop(~I(Age=="65+"),survey_design_ref,method="lo")
```

```{r prop Age subset ntdc}
svyciprop(~I(Age=="<15"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(Age=="15-24"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(Age=="25-44"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(Age=="45-64"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(Age=="65+"),survey_design_subset_ntdc,method="lo")
```

### ResidenceType

```{r counts ResidenceType all}
svytotal(~ResidenceType,design=survey_design_ref,na.rm=FALSE)
```

```{r counts ResidenceType subset ntdc}
svytotal(~ResidenceType,design=survey_design_subset_ntdc,na.rm=FALSE)
```

```{r prop ResidenceType all}
svyciprop(~I(ResidenceType=="Unknown"),survey_design_ref,method="lo")
svyciprop(~I(ResidenceType=="Private"),survey_design_ref,method="lo")
svyciprop(~I(ResidenceType=="Other"),survey_design_ref,method="lo")
```

```{r prop ResidenceType subset ntdc}
svyciprop(~I(ResidenceType=="Unknown"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(ResidenceType=="Private"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(ResidenceType=="Other"),survey_design_subset_ntdc,method="lo")
```

### Sex

```{r counts Sex all}
svytotal(~Sex,design=survey_design_ref,na.rm=FALSE)
```

```{r counts Sex subset ntdc}
svytotal(~Sex,design=survey_design_subset_ntdc,na.rm=FALSE)
```

```{r prop Sex all}
svyciprop(~I(Sex=="Female"),survey_design_ref,method="lo")
svyciprop(~I(Sex=="Male"),survey_design_ref,method="lo")
```

```{r prop Sex subset ntdc}
svyciprop(~I(Sex=="Female"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(Sex=="Male"),survey_design_subset_ntdc,method="lo")
```

### RaceEth 

```{r counts RaceEth all}
svytotal(~RaceEth,design=survey_design_ref,na.rm=FALSE)
```

```{r counts RaceEth subset ntdc}
svytotal(~RaceEth,design=survey_design_subset_ntdc,na.rm=FALSE)
```

```{r prop RaceEth all}
svyciprop(~I(RaceEth=="White"),survey_design_ref,method="lo")
svyciprop(~I(RaceEth=="Black"),survey_design_ref,method="lo")
svyciprop(~I(RaceEth=="Hisp."),survey_design_ref,method="lo")
svyciprop(~I(RaceEth=="Other"),survey_design_ref,method="lo")
```

```{r prop RaceEth subset ntdc}
svyciprop(~I(RaceEth=="White"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(RaceEth=="Black"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(RaceEth=="Hisp."),survey_design_subset_ntdc,method="lo")
svyciprop(~I(RaceEth=="Other"),survey_design_subset_ntdc,method="lo")
```

### PayerType

```{r counts PayerType all}
svytotal(~PayerType,design=survey_design_ref,na.rm=FALSE)
```

```{r counts PayerType subset ntdc}
svytotal(~PayerType,design=survey_design_subset_ntdc,na.rm=FALSE)
```

```{r prop PayerType all}
svyciprop(~I(PayerType=="Other"),survey_design_ref,method="lo")
svyciprop(~I(PayerType=="Private"),survey_design_ref,method="lo")
svyciprop(~I(PayerType=="Medicare"),survey_design_ref,method="lo")
svyciprop(~I(PayerType=="State"),survey_design_ref,method="lo")
svyciprop(~I(PayerType=="Self"),survey_design_ref,method="lo")
```

```{r prop PayerType subset ntdc}
svyciprop(~I(PayerType=="Other"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(PayerType=="Private"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(PayerType=="Medicare"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(PayerType=="State"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(PayerType=="Self"),survey_design_subset_ntdc,method="lo")
```

### diab_status

```{r counts diab_status all}
svytotal(~diab_status,design=survey_design_ref,na.rm=FALSE)
```

```{r counts diab_status subset ntdc}
svytotal(~diab_status,design=survey_design_subset_ntdc,na.rm=FALSE)
```

```{r prop diab_status all}
svyciprop(~I(diab_status=="No"),survey_design_ref,method="lo")
svyciprop(~I(diab_status=="Yes"),survey_design_ref,method="lo")
```

```{r prop diab_status subset ntdc}
svyciprop(~I(diab_status=="No"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(diab_status=="Yes"),survey_design_subset_ntdc,method="lo")
```

### substab_f

```{r counts substab_f all}
svytotal(~substab_f,design=survey_design_ref,na.rm=FALSE)
```

```{r counts substab_f subset ntdc}
svytotal(~substab_f,design=survey_design_subset_ntdc,na.rm=FALSE)
```

```{r prop substab_f all}
svyciprop(~I(substab_f=="No"),survey_design_ref,method="lo")
svyciprop(~I(substab_f=="Yes"),survey_design_ref,method="lo")
```

```{r prop substab_f subset ntdc}
svyciprop(~I(substab_f=="No"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(substab_f=="Yes"),survey_design_subset_ntdc,method="lo")
```

### seen72_f 

```{r counts seen72_f all}
svytotal(~seen72_f,design=survey_design_ref,na.rm=FALSE)
```

```{r counts seen72_f subset ntdc}
svytotal(~seen72_f,design=survey_design_subset_ntdc,na.rm=FALSE)
```

```{r prop seen72_f all}
svyciprop(~I(seen72_f=="Unspecified"),survey_design_ref,method="lo")
svyciprop(~I(seen72_f=="Yes"),survey_design_ref,method="lo")
svyciprop(~I(seen72_f=="No"),survey_design_ref,method="lo")
```

```{r prop seen72_f subset ntdc}
svyciprop(~I(seen72_f=="Unspecified"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(seen72_f=="Yes"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(seen72_f=="No"),survey_design_subset_ntdc,method="lo")
```

### rx_opioids

```{r counts rx_opioid all}
svytotal(~rx_opioid,design=survey_design_ref,na.rm=FALSE)
```

```{r counts rx_opioid subset ntdc}
svytotal(~rx_opioid,design=survey_design_subset_ntdc,na.rm=FALSE)
```

```{r prop rx_opioid all}
svyciprop(~I(rx_opioid=="No"),survey_design_ref,method="lo")
svyciprop(~I(rx_opioid=="Yes"),survey_design_ref,method="lo")
```

```{r prop rx_opioid subset ntdc}
svyciprop(~I(rx_opioid=="No"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(rx_opioid=="Yes"),survey_design_subset_ntdc,method="lo")
```

### rx_nsaid_ace

```{r counts rx_nsaid_ace all}
svytotal(~rx_nsaid_ace,design=survey_design_ref,na.rm=FALSE)
```

```{r counts rx_nsaid_ace subset ntdc}
svytotal(~rx_nsaid_ace,design=survey_design_subset_ntdc,na.rm=FALSE)
```

```{r prop rx_nsaid_ace all}
svyciprop(~I(rx_nsaid_ace=="No"),survey_design_ref,method="lo")
svyciprop(~I(rx_nsaid_ace=="Yes"),survey_design_ref,method="lo")
```

```{r prop rx_nsaid_ace subset ntdc}
svyciprop(~I(rx_nsaid_ace=="No"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(rx_nsaid_ace=="Yes"),survey_design_subset_ntdc,method="lo")
```

### rx_antibiotic

```{r counts rx_antibiotic all}
svytotal(~rx_antibiotic,survey_design_ref,na.rm=FALSE)
```

```{r counts rx_antibiotic subset ntdc}
svytotal(~rx_antibiotic,survey_design_subset_ntdc,na.rm=FALSE)
```

```{r prop rx_antibiotic all}
svyciprop(~I(rx_antibiotic=="No"),survey_design_ref,method="lo")
svyciprop(~I(rx_antibiotic=="Yes"),survey_design_ref,method="lo")
```

```{r prop rx_antibiotic subset ntdc}
svyciprop(~I(rx_antibiotic=="No"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(rx_antibiotic=="Yes"),survey_design_subset_ntdc,method="lo")
```

### Region

```{r counts Region all}
svytotal(~Region,design=survey_design_ref,na.rm=FALSE)
```

```{r counts Region subset ntdc}
svytotal(~Region,design=survey_design_subset_ntdc,na.rm=FALSE)
```

```{r prop Region all}
svyciprop(~I(Region=="NE"),survey_design_ref,method="lo")
svyciprop(~I(Region=="MW"),survey_design_ref,method="lo")
svyciprop(~I(Region=="S"),survey_design_ref,method="lo")
svyciprop(~I(Region=="W"),survey_design_ref,method="lo")
```

```{r prop Region subset ntdc}
svyciprop(~I(Region=="NE"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(Region=="MW"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(Region=="S"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(Region=="W"),survey_design_subset_ntdc,method="lo")
```

### Metro

```{r counts Metro all}
svytotal(~Metro,design=survey_design_ref,na.rm=FALSE)
```

```{r counts Metro subset ntdc}
svytotal(~Metro,design=survey_design_subset_ntdc,na.rm=FALSE)
```

```{r prop Metro all}
svyciprop(~I(Metro=="Metro"),survey_design_ref,method="lo")
svyciprop(~I(Metro=="Non-Metro"),survey_design_ref,method="lo")
```

### Year

```{r counts Year all}
svytotal(~Year,design=survey_design_ref,na.rm=FALSE)
```

```{r counts Year subset ntdc}
svytotal(~Year,design=survey_design_subset_ntdc,na.rm=FALSE)
```

```{r prop Year all}
svyciprop(~I(Year==2019),survey_design_ref,method="lo")
svyciprop(~I(Year==2020),survey_design_ref,method="lo")
svyciprop(~I(Year==2021),survey_design_ref,method="lo")
svyciprop(~I(Year==2022),survey_design_ref,method="lo")
```

```{r prop Year subset ntdc}
svyciprop(~I(Year==2019),survey_design_subset_ntdc,method="lo")
svyciprop(~I(Year==2020),survey_design_subset_ntdc,method="lo")
svyciprop(~I(Year==2021),survey_design_subset_ntdc,method="lo")
svyciprop(~I(Year==2022),survey_design_subset_ntdc,method="lo")
```

## Noncase Counts & Proportions, Weighted

### Age

```{r counts Age subset noncase}
svytotal(~Age,design=survey_design_subset_noncase,na.rm=FALSE)
```

```{r prop Age subset noncase}
svyciprop(~I(Age=="<15"),survey_design_subset_noncase,method="lo")
svyciprop(~I(Age=="15-24"),survey_design_subset_noncase,method="lo")
svyciprop(~I(Age=="25-44"),survey_design_subset_noncase,method="lo")
svyciprop(~I(Age=="45-64"),survey_design_subset_noncase,method="lo")
svyciprop(~I(Age=="65+"),survey_design_subset_noncase,method="lo")
```

### ResidenceType

```{r counts ResidenceType subset noncase}
svytotal(~ResidenceType,design=survey_design_subset_noncase,na.rm=FALSE)
```

```{r prop ResidenceType subset noncase}
svyciprop(~I(ResidenceType=="Unknown"),survey_design_subset_noncase,method="lo")
svyciprop(~I(ResidenceType=="Private"),survey_design_subset_noncase,method="lo")
svyciprop(~I(ResidenceType=="Other"),survey_design_subset_noncase,method="lo")
```

### Sex

```{r counts Sex subset noncase}
svytotal(~Sex,design=survey_design_subset_noncase,na.rm=FALSE)
```

```{r prop Sex subset noncase}
svyciprop(~I(Sex=="Female"),survey_design_subset_noncase,method="lo")
svyciprop(~I(Sex=="Male"),survey_design_subset_noncase,method="lo")
```

### RaceEth

```{r counts RaceEth subset noncase}
svytotal(~RaceEth,design=survey_design_subset_noncase,na.rm=FALSE)
```

```{r prop RaceEth subset noncase}
svyciprop(~I(RaceEth=="White"),survey_design_subset_noncase,method="lo")
svyciprop(~I(RaceEth=="Black"),survey_design_subset_noncase,method="lo")
svyciprop(~I(RaceEth=="Hisp."),survey_design_subset_noncase,method="lo")
svyciprop(~I(RaceEth=="Other"),survey_design_subset_noncase,method="lo")
```

### PayerType

```{r counts PayerType subset noncase}
svytotal(~PayerType,design=survey_design_subset_noncase,na.rm=FALSE)
```

```{r prop PayerType subset noncase}
svyciprop(~I(PayerType=="Other"),survey_design_subset_noncase,method="lo")
svyciprop(~I(PayerType=="Private"),survey_design_subset_noncase,method="lo")
svyciprop(~I(PayerType=="Medicare"),survey_design_subset_noncase,method="lo")
svyciprop(~I(PayerType=="State"),survey_design_subset_noncase,method="lo")
svyciprop(~I(PayerType=="Self"),survey_design_subset_noncase,method="lo")
```

### diab_status

```{r counts diab_status subset noncase}
svytotal(~diab_status,design=survey_design_subset_noncase,na.rm=FALSE)
```

```{r prop diab_status subset noncase}
svyciprop(~I(diab_status=="No"),survey_design_subset_noncase,method="lo")
svyciprop(~I(diab_status=="Yes"),survey_design_subset_noncase,method="lo")
```

### substab_f

```{r counts substab_f subset noncase}
svytotal(~substab_f,design=survey_design_subset_noncase,na.rm=FALSE)
```

```{r prop substab_f subset noncase}
svyciprop(~I(substab_f=="No"),survey_design_subset_noncase,method="lo")
svyciprop(~I(substab_f=="Yes"),survey_design_subset_noncase,method="lo")
```

### seen72_f

```{r counts seen72_f subset noncase}
svytotal(~seen72_f,design=survey_design_subset_noncase,na.rm=FALSE)
```

```{r prop seen72_f subset noncase}
svyciprop(~I(seen72_f=="No"),survey_design_subset_noncase,method="lo")
svyciprop(~I(seen72_f=="Yes"),survey_design_subset_noncase,method="lo")
```

### rx_opioid

```{r counts rx_opioid subset noncase}
svytotal(~rx_opioid,design=survey_design_subset_noncase,na.rm=FALSE)
```

```{r prop rx_opioid subset noncase}
svyciprop(~I(rx_opioid=="No"),survey_design_subset_noncase,method="lo")
svyciprop(~I(rx_opioid=="Yes"),survey_design_subset_noncase,method="lo")
```

### rx_nsaid_ace

```{r counts rx_nsaid_ace subset noncase}
svytotal(~rx_nsaid_ace,design=survey_design_subset_noncase,na.rm=FALSE)
```

```{r prop rx_nsaid_ace subset noncase}
svyciprop(~I(rx_nsaid_ace=="No"),survey_design_subset_noncase,method="lo")
svyciprop(~I(rx_nsaid_ace=="Yes"),survey_design_subset_noncase,method="lo")
```

### rx_antibiotic

```{r counts rx_antibiotic subset noncase}
svytotal(~rx_antibiotic,design=survey_design_subset_noncase,na.rm=FALSE)
```

```{r prop rx_antibiotic subset noncase}
svyciprop(~I(rx_antibiotic=="No"),survey_design_subset_noncase,method="lo")
svyciprop(~I(rx_antibiotic=="Yes"),survey_design_subset_noncase,method="lo")
```

### Region

```{r counts Region subset noncase}
svytotal(~Region,design=survey_design_subset_noncase,na.rm=FALSE)
```

```{r prop Region subset noncase}
svyciprop(~I(Region=="NE"),survey_design_subset_noncase,method="lo")
svyciprop(~I(Region=="MW"),survey_design_subset_noncase,method="lo")
svyciprop(~I(Region=="S"),survey_design_subset_noncase,method="lo")
svyciprop(~I(Region=="W"),survey_design_subset_noncase,method="lo")
```

### Metro

```{r counts Metro subset noncase}
svytotal(~Metro,design=survey_design_subset_noncase,na.rm=FALSE)
```

```{r prop Metro subset noncase}
svyciprop(~I(Metro=="Metro"),survey_design_subset_noncase,method="lo")
svyciprop(~I(Metro=="Non-Metro"),survey_design_subset_noncase,method="lo")
```

### Year

```{r counts Year subset noncase}
svytotal(~Year,design=survey_design_subset_noncase,na.rm=FALSE)
```

```{r prop Year subset noncase}
svyciprop(~I(Year==2019),survey_design_subset_noncase,method="lo")
svyciprop(~I(Year==2020),survey_design_subset_noncase,method="lo")
svyciprop(~I(Year==2021),survey_design_subset_noncase,method="lo")
svyciprop(~I(Year==2022),survey_design_subset_noncase,method="lo")
```

## Chi-Square for Proportions

### geo_strata

```{r chisq geo_strata}
svychisq(~geo_strata+DentalVisit,survey_design_ref,statistic="Wald")
```

### Age

```{r chisq Age}
svychisq(~Age+DentalVisit,survey_design_ref,statistic="Wald")
```

### ResidenceType

```{r chisq ResidenceType}
svychisq(~ResidenceType+DentalVisit,survey_design_ref,statistic="Wald")
```

### Sex

```{r chisq Sex}
svychisq(~Sex+DentalVisit,survey_design_ref,statistic="Wald")
```

### RaceEth

```{r chisq RaceEth}
svychisq(~RaceEth+DentalVisit,survey_design_ref,statistic="Wald")
```

### PayerType

```{r chisq PayerType}
svychisq(~PayerType+DentalVisit,survey_design_ref,statistic="Wald")
```

### diab_status

```{r chisq diab_status}
svychisq(~diab_status+DentalVisit,survey_design_ref,statistic="Wald")
```

### substab_f

```{r chisq substab_f}
svychisq(~substab_f+DentalVisit,survey_design_ref,statistic="Wald")
```

### seen72_f

```{r chisq seen72_f}
svychisq(~seen72_f+DentalVisit,survey_design_ref,statistic="Wald")
```

### rx_opioid

```{r chisq rx_opioid}
svychisq(~rx_opioid+DentalVisit,survey_design_ref,statistic="Wald")
```

### rx_nsaid_ace

```{r chisq rx_nsaid_ace}
svychisq(~rx_nsaid_ace+DentalVisit,survey_design_ref,statistic="Wald")
```

### rx_antibiotic

```{r chisq rx_antibiotic}
svychisq(~rx_antibiotic+DentalVisit,survey_design_ref,statistic="Wald")
```

### Region

```{r chisq Region}
svychisq(~Region+DentalVisit,survey_design_ref,statistic="Wald")
```

### Metro

```{r chisq Metro}
svychisq(~Metro+DentalVisit,survey_design_ref,statistic="Wald")
```

### Year

```{r chisq Year}
svychisq(~Year+DentalVisit,survey_design_ref,statistic="Wald")
```

# Geographic Strata Descriptives

## svyciprop table function(x)

```{r function to extract svyciprop values into df}
extract_tbl <- function(x) {
  v <- attr(x, "names")
  ci <- attr(x,"ci")
  y <- cbind(data.frame(var=v,prop=c(round(x,5))),as.data.frame(t(ci)))
  row.names(y) <- NULL
  y
}
```

## G1 NE MSA

### Age G1

```{r}
svychisq(~Age+DentalVisit,survey_design_subset_geo1,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(Age=="<15"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_age_dent_1
extract_tbl(
  svyciprop(~I(Age=="15-24"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_age_dent_2
extract_tbl(
  svyciprop(~I(Age=="25-44"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_age_dent_3 
extract_tbl(
  svyciprop(~I(Age=="45-64"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_age_dent_4
extract_tbl(
  svyciprop(~I(Age=="65+"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_age_dent_5
extract_tbl(
  svyciprop(~I(Age=="<15"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_age_non_1
extract_tbl(
  svyciprop(~I(Age=="15-24"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_age_non_2
extract_tbl(
  svyciprop(~I(Age=="25-44"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_age_non_3
extract_tbl(
  svyciprop(~I(Age=="45-64"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_age_non_4
extract_tbl(
  svyciprop(~I(Age=="65+"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_age_non_5
bind_rows(g1_age_dent_1,
          g1_age_dent_2,
          g1_age_dent_3,
          g1_age_dent_4,
          g1_age_dent_5,
          g1_age_non_1,
          g1_age_non_2,
          g1_age_non_3,
          g1_age_non_4,
          g1_age_non_5) -> df_prop_age_g1
print(df_prop_age_g1)
```


### ResidenceType G1

```{r}
svychisq(~ResidenceType+DentalVisit,survey_design_subset_geo1,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(ResidenceType=="Unknown"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_res_dent_1
extract_tbl(
  svyciprop(~I(ResidenceType=="Private"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_res_dent_2
extract_tbl(
  svyciprop(~I(ResidenceType=="Other"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_res_dent_3 
extract_tbl(
  svyciprop(~I(ResidenceType=="Unknown"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_res_non_1
extract_tbl(
  svyciprop(~I(ResidenceType=="Private"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_res_non_2
extract_tbl(
  svyciprop(~I(ResidenceType=="Other"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_res_non_3
bind_rows(g1_res_dent_1,
          g1_res_dent_2,
          g1_res_dent_3,
          g1_res_non_1,
          g1_res_non_2,
          g1_res_non_3) -> df_prop_res_g1
print(df_prop_res_g1)
```

### Sex G1

```{r}
svychisq(~Sex+DentalVisit,survey_design_subset_geo1,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(Sex=="Female"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_sex_dent_1
extract_tbl(
  svyciprop(~I(Sex=="Male"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_sex_dent_2
extract_tbl(
  svyciprop(~I(Sex=="Female"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_sex_non_1
extract_tbl(
  svyciprop(~I(Sex=="Male"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_sex_non_2
bind_rows(g1_sex_dent_1,
          g1_sex_dent_2,
          g1_sex_non_1,
          g1_sex_non_2) -> df_prop_sex_g1
print(df_prop_sex_g1)
```


### RaceEth G1

```{r}
svytotal(~RaceEth,design=survey_design_subset_g1_dent,na.rm=FALSE)
```

```{r}
svychisq(~RaceEth+DentalVisit,survey_design_subset_geo1,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(RaceEth=="White"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_race_dent_1
extract_tbl(
  svyciprop(~I(RaceEth=="Black"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_race_dent_2
extract_tbl(
  svyciprop(~I(RaceEth=="Hisp."),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_race_dent_3
extract_tbl(
  svyciprop(~I(RaceEth=="Other"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_race_dent_4
extract_tbl(
  svyciprop(~I(RaceEth=="White"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_race_non_1
extract_tbl(
  svyciprop(~I(RaceEth=="Black"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_race_non_2
extract_tbl(
  svyciprop(~I(RaceEth=="Hisp."),
            survey_design_subset_g1_non,
            method="lo")) -> g1_race_non_3
extract_tbl(
  svyciprop(~I(RaceEth=="Other"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_race_non_4
bind_rows(g1_race_dent_1,
          g1_race_dent_2,
          g1_race_dent_3,
          g1_race_dent_4,
          g1_race_non_1,
          g1_race_non_2,
          g1_race_non_3,
          g1_race_non_4) -> df_prop_race_g1
print(df_prop_race_g1)
```


### PayerType G1

```{r}
svychisq(~PayerType+DentalVisit,survey_design_subset_geo1,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(PayerType=="Other"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_payer_dent_1
extract_tbl(
  svyciprop(~I(PayerType=="Private"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_payer_dent_2
extract_tbl(
  svyciprop(~I(PayerType=="Medicare"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_payer_dent_3
extract_tbl(
  svyciprop(~I(PayerType=="State"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_payer_dent_4
extract_tbl(
  svyciprop(~I(PayerType=="Self"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_payer_dent_5
extract_tbl(
  svyciprop(~I(PayerType=="Other"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_payer_non_1
extract_tbl(
  svyciprop(~I(PayerType=="Private"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_payer_non_2
extract_tbl(
  svyciprop(~I(PayerType=="Medicare"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_payer_non_3
extract_tbl(
  svyciprop(~I(PayerType=="State"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_payer_non_4
extract_tbl(
  svyciprop(~I(PayerType=="Self"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_payer_non_5
bind_rows(g1_payer_dent_1,
          g1_payer_dent_2,
          g1_payer_dent_3,
          g1_payer_dent_4,
          g1_payer_dent_5,
          g1_payer_non_1,
          g1_payer_non_2,
          g1_payer_non_3,
          g1_payer_non_4,
          g1_payer_non_5) -> df_prop_payer_g1
print(df_prop_payer_g1)
```

### diab_status G1

```{r}
svychisq(~diab_status+DentalVisit,survey_design_subset_geo1,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(diab_status=="No"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_diab_dent_1
extract_tbl(
  svyciprop(~I(diab_status=="Yes"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_diab_dent_2
extract_tbl(
  svyciprop(~I(diab_status=="No"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_diab_non_1
extract_tbl(
  svyciprop(~I(diab_status=="Yes"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_diab_non_2
bind_rows(g1_diab_dent_1,
          g1_diab_dent_2,
          g1_diab_non_1,
          g1_diab_non_2) -> df_prop_diab_g1
print(df_prop_diab_g1)
```

### substab_f G1

```{r}
svychisq(~substab_f+DentalVisit,survey_design_subset_geo1,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(substab_f=="No"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_subs_dent_1
extract_tbl(
  svyciprop(~I(substab_f=="Yes"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_subs_dent_2
extract_tbl(
  svyciprop(~I(substab_f=="No"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_subs_non_1
extract_tbl(
  svyciprop(~I(substab_f=="Yes"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_subs_non_2
bind_rows(g1_subs_dent_1,
          g1_subs_dent_2,
          g1_subs_non_1,
          g1_subs_non_2) -> df_prop_subs_g1
print(df_prop_subs_g1)
```

### seen72_f G1

```{r}
svychisq(~seen72_f+DentalVisit,survey_design_subset_geo1,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(seen72_f=="Unspecified"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_seen_dent_1
extract_tbl(
  svyciprop(~I(seen72_f=="No"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_seen_dent_2
extract_tbl(
  svyciprop(~I(seen72_f=="Yes"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_seen_dent_3
extract_tbl(
  svyciprop(~I(seen72_f=="Unspecified"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_seen_non_1
extract_tbl(
  svyciprop(~I(seen72_f=="No"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_seen_non_2
extract_tbl(
  svyciprop(~I(seen72_f=="Yes"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_seen_non_3
bind_rows(g1_seen_dent_1,
          g1_seen_dent_2,
          g1_seen_dent_3,
          g1_seen_non_1,
          g1_seen_non_2,
          g1_seen_non_3) -> df_prop_seen_g1
print(df_prop_seen_g1)
```

### rx_opioid G1

```{r}
svychisq(~rx_opioid+DentalVisit,survey_design_subset_geo1,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(rx_opioid=="No"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_opi_dent_1
extract_tbl(
  svyciprop(~I(rx_opioid=="Yes"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_opi_dent_2
extract_tbl(
  svyciprop(~I(rx_opioid=="No"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_opi_non_1
extract_tbl(
  svyciprop(~I(rx_opioid=="Yes"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_opi_non_2
bind_rows(g1_opi_dent_1,
          g1_opi_dent_2,
          g1_opi_non_1,
          g1_opi_non_2) -> df_prop_opi_g1
print(df_prop_opi_g1)
```

### rx_nsaid_ace G1

```{r}
svychisq(~rx_nsaid_ace+DentalVisit,survey_design_subset_geo1,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="No"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_nsaid_dent_1
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="Yes"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_nsaid_dent_2
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="No"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_nsaid_non_1
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="Yes"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_nsaid_non_2
bind_rows(g1_nsaid_dent_1,
          g1_nsaid_dent_2,
          g1_nsaid_non_1,
          g1_nsaid_non_2) -> df_prop_nsaid_g1
print(df_prop_nsaid_g1)
```

### rx_antibiotic G1

```{r}
svychisq(~rx_antibiotic+DentalVisit,survey_design_subset_geo1,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(rx_antibiotic=="No"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_antib_dent_1
extract_tbl(
  svyciprop(~I(rx_antibiotic=="Yes"),
            survey_design_subset_g1_dent,
            method="lo")) -> g1_antib_dent_2
extract_tbl(
  svyciprop(~I(rx_antibiotic=="No"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_antib_non_1
extract_tbl(
  svyciprop(~I(rx_antibiotic=="Yes"),
            survey_design_subset_g1_non,
            method="lo")) -> g1_antib_non_2
bind_rows(g1_antib_dent_1,
          g1_antib_dent_2,
          g1_antib_non_1,
          g1_antib_non_2) -> df_prop_antib_g1
print(df_prop_antib_g1)
```

### Bind G1

```{r}
bind_rows(df_prop_age_g1,df_prop_res_g1,df_prop_sex_g1,df_prop_race_g1,df_prop_payer_g1,df_prop_diab_g1,df_prop_subs_g1,df_prop_seen_g1,df_prop_opi_g1,df_prop_nsaid_g1,df_prop_antib_g1) -> df_g1_vars
glimpse(df_g1_vars)
```

## G2 NE non-MSA

### Age G2

```{r}
#svychisq(~Age+DentalVisit,survey_design_subset_geo2,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(Age=="<15"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_age_dent_1
extract_tbl(
  svyciprop(~I(Age=="15-24"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_age_dent_2
extract_tbl(
  svyciprop(~I(Age=="25-44"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_age_dent_3 
extract_tbl(
  svyciprop(~I(Age=="45-64"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_age_dent_4
extract_tbl(
  svyciprop(~I(Age=="65+"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_age_dent_5
extract_tbl(
  svyciprop(~I(Age=="<15"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_age_non_1
extract_tbl(
  svyciprop(~I(Age=="15-24"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_age_non_2
extract_tbl(
  svyciprop(~I(Age=="25-44"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_age_non_3
extract_tbl(
  svyciprop(~I(Age=="45-64"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_age_non_4
extract_tbl(
  svyciprop(~I(Age=="65+"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_age_non_5
bind_rows(g2_age_dent_1,
          g2_age_dent_2,
          g2_age_dent_3,
          g2_age_dent_4,
          g2_age_dent_5,
          g2_age_non_1,
          g2_age_non_2,
          g2_age_non_3,
          g2_age_non_4,
          g2_age_non_5) -> df_prop_age_g2
print(df_prop_age_g2)
```


### ResidenceType G2

```{r}
svychisq(~ResidenceType+DentalVisit,survey_design_subset_geo2,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(ResidenceType=="Unknown"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_res_dent_1
extract_tbl(
  svyciprop(~I(ResidenceType=="Private"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_res_dent_2
extract_tbl(
  svyciprop(~I(ResidenceType=="Other"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_res_dent_3 
extract_tbl(
  svyciprop(~I(ResidenceType=="Unknown"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_res_non_1
extract_tbl(
  svyciprop(~I(ResidenceType=="Private"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_res_non_2
extract_tbl(
  svyciprop(~I(ResidenceType=="Other"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_res_non_3
bind_rows(g2_res_dent_1,
          g2_res_dent_2,
          g2_res_dent_3,
          g2_res_non_1,
          g2_res_non_2,
          g2_res_non_3) -> df_prop_res_g2
print(df_prop_res_g2)
```

### Sex G2

```{r}
svychisq(~Sex+DentalVisit,survey_design_subset_geo2,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(Sex=="Female"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_sex_dent_1
extract_tbl(
  svyciprop(~I(Sex=="Male"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_sex_dent_2
extract_tbl(
  svyciprop(~I(Sex=="Female"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_sex_non_1
extract_tbl(
  svyciprop(~I(Sex=="Male"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_sex_non_2
bind_rows(g2_sex_dent_1,
          g2_sex_dent_2,
          g2_sex_non_1,
          g2_sex_non_2) -> df_prop_sex_g2
print(df_prop_sex_g2)
```


### RaceEth G2

```{r}
svytotal(~RaceEth,design=survey_design_subset_g2_dent,na.rm=FALSE)
```

```{r}
#svychisq(~RaceEth+DentalVisit,survey_design_subset_geo2,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(RaceEth=="White"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_race_dent_1
extract_tbl(
  svyciprop(~I(RaceEth=="Black"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_race_dent_2
extract_tbl(
  svyciprop(~I(RaceEth=="Hisp."),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_race_dent_3
extract_tbl(
  svyciprop(~I(RaceEth=="Other"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_race_dent_4
extract_tbl(
  svyciprop(~I(RaceEth=="White"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_race_non_1
extract_tbl(
  svyciprop(~I(RaceEth=="Black"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_race_non_2
extract_tbl(
  svyciprop(~I(RaceEth=="Hisp."),
            survey_design_subset_g2_non,
            method="lo")) -> g2_race_non_3
extract_tbl(
  svyciprop(~I(RaceEth=="Other"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_race_non_4
bind_rows(g2_race_dent_1,
          g2_race_dent_2,
          g2_race_dent_3,
          g2_race_dent_4,
          g2_race_non_1,
          g2_race_non_2,
          g2_race_non_3,
          g2_race_non_4) -> df_prop_race_g2
print(df_prop_race_g2)
```


### PayerType G2

```{r}
#svychisq(~PayerType+DentalVisit,survey_design_subset_geo2,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(PayerType=="Other"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_payer_dent_1
extract_tbl(
  svyciprop(~I(PayerType=="Private"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_payer_dent_2
extract_tbl(
  svyciprop(~I(PayerType=="Medicare"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_payer_dent_3
extract_tbl(
  svyciprop(~I(PayerType=="State"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_payer_dent_4
extract_tbl(
  svyciprop(~I(PayerType=="Self"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_payer_dent_5
extract_tbl(
  svyciprop(~I(PayerType=="Other"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_payer_non_1
extract_tbl(
  svyciprop(~I(PayerType=="Private"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_payer_non_2
extract_tbl(
  svyciprop(~I(PayerType=="Medicare"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_payer_non_3
extract_tbl(
  svyciprop(~I(PayerType=="State"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_payer_non_4
extract_tbl(
  svyciprop(~I(PayerType=="Self"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_payer_non_5
bind_rows(g2_payer_dent_1,
          g2_payer_dent_2,
          g2_payer_dent_3,
          g2_payer_dent_4,
          g2_payer_dent_5,
          g2_payer_non_1,
          g2_payer_non_2,
          g2_payer_non_3,
          g2_payer_non_4,
          g2_payer_non_5) -> df_prop_payer_g2
print(df_prop_payer_g2)
```

### diab_status G2

```{r}
svychisq(~diab_status+DentalVisit,survey_design_subset_geo2,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(diab_status=="No"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_diab_dent_1
extract_tbl(
  svyciprop(~I(diab_status=="Yes"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_diab_dent_2
extract_tbl(
  svyciprop(~I(diab_status=="No"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_diab_non_1
extract_tbl(
  svyciprop(~I(diab_status=="Yes"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_diab_non_2
bind_rows(g2_diab_dent_1,
          g2_diab_dent_2,
          g2_diab_non_1,
          g2_diab_non_2) -> df_prop_diab_g2
print(df_prop_diab_g2)
```

### substab_f G2

```{r}
svychisq(~substab_f+DentalVisit,survey_design_subset_geo2,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(substab_f=="No"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_subs_dent_1
extract_tbl(
  svyciprop(~I(substab_f=="Yes"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_subs_dent_2
extract_tbl(
  svyciprop(~I(substab_f=="No"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_subs_non_1
extract_tbl(
  svyciprop(~I(substab_f=="Yes"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_subs_non_2
bind_rows(g2_subs_dent_1,
          g2_subs_dent_2,
          g2_subs_non_1,
          g2_subs_non_2) -> df_prop_subs_g2
print(df_prop_subs_g2)
```

### seen72_f G2

```{r}
svychisq(~seen72_f+DentalVisit,survey_design_subset_geo2,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(seen72_f=="Unspecified"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_seen_dent_1
extract_tbl(
  svyciprop(~I(seen72_f=="No"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_seen_dent_2
extract_tbl(
  svyciprop(~I(seen72_f=="Yes"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_seen_dent_3
extract_tbl(
  svyciprop(~I(seen72_f=="Unspecified"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_seen_non_1
extract_tbl(
  svyciprop(~I(seen72_f=="No"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_seen_non_2
extract_tbl(
  svyciprop(~I(seen72_f=="Yes"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_seen_non_3
bind_rows(g2_seen_dent_1,
          g2_seen_dent_2,
          g2_seen_dent_3,
          g2_seen_non_1,
          g2_seen_non_2,
          g2_seen_non_3) -> df_prop_seen_g2
print(df_prop_seen_g2)
```

### rx_opioid G2

```{r}
svychisq(~rx_opioid+DentalVisit,survey_design_subset_geo2,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(rx_opioid=="No"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_opi_dent_1
extract_tbl(
  svyciprop(~I(rx_opioid=="Yes"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_opi_dent_2
extract_tbl(
  svyciprop(~I(rx_opioid=="No"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_opi_non_1
extract_tbl(
  svyciprop(~I(rx_opioid=="Yes"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_opi_non_2
bind_rows(g2_opi_dent_1,
          g2_opi_dent_2,
          g2_opi_non_1,
          g2_opi_non_2) -> df_prop_opi_g2
print(df_prop_opi_g2)
```

### rx_nsaid_ace G2

```{r}
svychisq(~rx_nsaid_ace+DentalVisit,survey_design_subset_geo2,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="No"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_nsaid_dent_1
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="Yes"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_nsaid_dent_2
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="No"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_nsaid_non_1
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="Yes"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_nsaid_non_2
bind_rows(g2_nsaid_dent_1,
          g2_nsaid_dent_2,
          g2_nsaid_non_1,
          g2_nsaid_non_2) -> df_prop_nsaid_g2
print(df_prop_nsaid_g2)
```

### rx_antibiotic G2

```{r}
svychisq(~rx_antibiotic+DentalVisit,survey_design_subset_geo2,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(rx_antibiotic=="No"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_antib_dent_1
extract_tbl(
  svyciprop(~I(rx_antibiotic=="Yes"),
            survey_design_subset_g2_dent,
            method="lo")) -> g2_antib_dent_2
extract_tbl(
  svyciprop(~I(rx_antibiotic=="No"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_antib_non_1
extract_tbl(
  svyciprop(~I(rx_antibiotic=="Yes"),
            survey_design_subset_g2_non,
            method="lo")) -> g2_antib_non_2
bind_rows(g2_antib_dent_1,
          g2_antib_dent_2,
          g2_antib_non_1,
          g2_antib_non_2) -> df_prop_antib_g2
print(df_prop_antib_g2)
```

### Bind G2

```{r}
bind_rows(df_prop_age_g2,df_prop_res_g2,df_prop_sex_g2,df_prop_race_g2,df_prop_payer_g2,df_prop_diab_g2,df_prop_subs_g2,df_prop_seen_g2,df_prop_opi_g2,df_prop_nsaid_g2,df_prop_antib_g2) -> df_g2_vars
glimpse(df_g2_vars)
```

## G3 MW MSA

### Age G3

```{r}
svychisq(~Age+DentalVisit,survey_design_subset_geo3,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(Age=="<15"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_age_dent_1
extract_tbl(
  svyciprop(~I(Age=="15-24"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_age_dent_2
extract_tbl(
  svyciprop(~I(Age=="25-44"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_age_dent_3 
extract_tbl(
  svyciprop(~I(Age=="45-64"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_age_dent_4
extract_tbl(
  svyciprop(~I(Age=="65+"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_age_dent_5
extract_tbl(
  svyciprop(~I(Age=="<15"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_age_non_1
extract_tbl(
  svyciprop(~I(Age=="15-24"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_age_non_2
extract_tbl(
  svyciprop(~I(Age=="25-44"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_age_non_3
extract_tbl(
  svyciprop(~I(Age=="45-64"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_age_non_4
extract_tbl(
  svyciprop(~I(Age=="65+"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_age_non_5
bind_rows(g3_age_dent_1,
          g3_age_dent_2,
          g3_age_dent_3,
          g3_age_dent_4,
          g3_age_dent_5,
          g3_age_non_1,
          g3_age_non_2,
          g3_age_non_3,
          g3_age_non_4,
          g3_age_non_5) -> df_prop_age_g3
print(df_prop_age_g3)
```


### ResidenceType G3

```{r}
svychisq(~ResidenceType+DentalVisit,survey_design_subset_geo3,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(ResidenceType=="Unknown"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_res_dent_1
extract_tbl(
  svyciprop(~I(ResidenceType=="Private"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_res_dent_2
extract_tbl(
  svyciprop(~I(ResidenceType=="Other"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_res_dent_3 
extract_tbl(
  svyciprop(~I(ResidenceType=="Unknown"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_res_non_1
extract_tbl(
  svyciprop(~I(ResidenceType=="Private"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_res_non_2
extract_tbl(
  svyciprop(~I(ResidenceType=="Other"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_res_non_3
bind_rows(g3_res_dent_1,
          g3_res_dent_2,
          g3_res_dent_3,
          g3_res_non_1,
          g3_res_non_2,
          g3_res_non_3) -> df_prop_res_g3
print(df_prop_res_g3)
```

### Sex G3

```{r}
svychisq(~Sex+DentalVisit,survey_design_subset_geo3,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(Sex=="Female"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_sex_dent_1
extract_tbl(
  svyciprop(~I(Sex=="Male"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_sex_dent_2
extract_tbl(
  svyciprop(~I(Sex=="Female"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_sex_non_1
extract_tbl(
  svyciprop(~I(Sex=="Male"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_sex_non_2
bind_rows(g3_sex_dent_1,
          g3_sex_dent_2,
          g3_sex_non_1,
          g3_sex_non_2) -> df_prop_sex_g3
print(df_prop_sex_g3)
```


### RaceEth G3

```{r}
svytotal(~RaceEth,design=survey_design_subset_g3_dent,na.rm=FALSE)
```

```{r}
svychisq(~RaceEth+DentalVisit,survey_design_subset_geo3,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(RaceEth=="White"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_race_dent_1
extract_tbl(
  svyciprop(~I(RaceEth=="Black"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_race_dent_2
extract_tbl(
  svyciprop(~I(RaceEth=="Hisp."),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_race_dent_3
extract_tbl(
  svyciprop(~I(RaceEth=="Other"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_race_dent_4
extract_tbl(
  svyciprop(~I(RaceEth=="White"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_race_non_1
extract_tbl(
  svyciprop(~I(RaceEth=="Black"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_race_non_2
extract_tbl(
  svyciprop(~I(RaceEth=="Hisp."),
            survey_design_subset_g3_non,
            method="lo")) -> g3_race_non_3
extract_tbl(
  svyciprop(~I(RaceEth=="Other"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_race_non_4
bind_rows(g3_race_dent_1,
          g3_race_dent_2,
          g3_race_dent_3,
          g3_race_dent_4,
          g3_race_non_1,
          g3_race_non_2,
          g3_race_non_3,
          g3_race_non_4) -> df_prop_race_g3
print(df_prop_race_g3)
```


### PayerType G3

```{r}
svychisq(~PayerType+DentalVisit,survey_design_subset_geo3,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(PayerType=="Other"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_payer_dent_1
extract_tbl(
  svyciprop(~I(PayerType=="Private"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_payer_dent_2
extract_tbl(
  svyciprop(~I(PayerType=="Medicare"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_payer_dent_3
extract_tbl(
  svyciprop(~I(PayerType=="State"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_payer_dent_4
extract_tbl(
  svyciprop(~I(PayerType=="Self"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_payer_dent_5
extract_tbl(
  svyciprop(~I(PayerType=="Other"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_payer_non_1
extract_tbl(
  svyciprop(~I(PayerType=="Private"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_payer_non_2
extract_tbl(
  svyciprop(~I(PayerType=="Medicare"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_payer_non_3
extract_tbl(
  svyciprop(~I(PayerType=="State"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_payer_non_4
extract_tbl(
  svyciprop(~I(PayerType=="Self"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_payer_non_5
bind_rows(g3_payer_dent_1,
          g3_payer_dent_2,
          g3_payer_dent_3,
          g3_payer_dent_4,
          g3_payer_dent_5,
          g3_payer_non_1,
          g3_payer_non_2,
          g3_payer_non_3,
          g3_payer_non_4,
          g3_payer_non_5) -> df_prop_payer_g3
print(df_prop_payer_g3)
```

### diab_status G3

```{r}
svychisq(~diab_status+DentalVisit,survey_design_subset_geo3,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(diab_status=="No"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_diab_dent_1
extract_tbl(
  svyciprop(~I(diab_status=="Yes"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_diab_dent_2
extract_tbl(
  svyciprop(~I(diab_status=="No"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_diab_non_1
extract_tbl(
  svyciprop(~I(diab_status=="Yes"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_diab_non_2
bind_rows(g3_diab_dent_1,
          g3_diab_dent_2,
          g3_diab_non_1,
          g3_diab_non_2) -> df_prop_diab_g3
print(df_prop_diab_g3)
```

### substab_f G3

```{r}
svychisq(~substab_f+DentalVisit,survey_design_subset_geo3,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(substab_f=="No"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_subs_dent_1
extract_tbl(
  svyciprop(~I(substab_f=="Yes"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_subs_dent_2
extract_tbl(
  svyciprop(~I(substab_f=="No"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_subs_non_1
extract_tbl(
  svyciprop(~I(substab_f=="Yes"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_subs_non_2
bind_rows(g3_subs_dent_1,
          g3_subs_dent_2,
          g3_subs_non_1,
          g3_subs_non_2) -> df_prop_subs_g3
print(df_prop_subs_g3)
```

### seen72_f G3

```{r}
svychisq(~seen72_f+DentalVisit,survey_design_subset_geo3,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(seen72_f=="Unspecified"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_seen_dent_1
extract_tbl(
  svyciprop(~I(seen72_f=="No"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_seen_dent_2
extract_tbl(
  svyciprop(~I(seen72_f=="Yes"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_seen_dent_3
extract_tbl(
  svyciprop(~I(seen72_f=="Unspecified"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_seen_non_1
extract_tbl(
  svyciprop(~I(seen72_f=="No"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_seen_non_2
extract_tbl(
  svyciprop(~I(seen72_f=="Yes"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_seen_non_3
bind_rows(g3_seen_dent_1,
          g3_seen_dent_2,
          g3_seen_dent_3,
          g3_seen_non_1,
          g3_seen_non_2,
          g3_seen_non_3) -> df_prop_seen_g3
print(df_prop_seen_g3)
```

### rx_opioid G3

```{r}
svychisq(~rx_opioid+DentalVisit,survey_design_subset_geo3,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(rx_opioid=="No"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_opi_dent_1
extract_tbl(
  svyciprop(~I(rx_opioid=="Yes"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_opi_dent_2
extract_tbl(
  svyciprop(~I(rx_opioid=="No"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_opi_non_1
extract_tbl(
  svyciprop(~I(rx_opioid=="Yes"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_opi_non_2
bind_rows(g3_opi_dent_1,
          g3_opi_dent_2,
          g3_opi_non_1,
          g3_opi_non_2) -> df_prop_opi_g3
print(df_prop_opi_g3)
```

### rx_nsaid_ace G3

```{r}
svychisq(~rx_nsaid_ace+DentalVisit,survey_design_subset_geo3,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="No"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_nsaid_dent_1
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="Yes"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_nsaid_dent_2
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="No"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_nsaid_non_1
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="Yes"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_nsaid_non_2
bind_rows(g3_nsaid_dent_1,
          g3_nsaid_dent_2,
          g3_nsaid_non_1,
          g3_nsaid_non_2) -> df_prop_nsaid_g3
print(df_prop_nsaid_g3)
```

### rx_antibiotic G3

```{r}
svychisq(~rx_antibiotic+DentalVisit,survey_design_subset_geo3,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(rx_antibiotic=="No"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_antib_dent_1
extract_tbl(
  svyciprop(~I(rx_antibiotic=="Yes"),
            survey_design_subset_g3_dent,
            method="lo")) -> g3_antib_dent_2
extract_tbl(
  svyciprop(~I(rx_antibiotic=="No"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_antib_non_1
extract_tbl(
  svyciprop(~I(rx_antibiotic=="Yes"),
            survey_design_subset_g3_non,
            method="lo")) -> g3_antib_non_2
bind_rows(g3_antib_dent_1,
          g3_antib_dent_2,
          g3_antib_non_1,
          g3_antib_non_2) -> df_prop_antib_g3
print(df_prop_antib_g3)
```

### Bind G3

```{r}
bind_rows(df_prop_age_g3,df_prop_res_g3,df_prop_sex_g3,df_prop_race_g3,df_prop_payer_g3,df_prop_diab_g3,df_prop_subs_g3,df_prop_seen_g3,df_prop_opi_g3,df_prop_nsaid_g3,df_prop_antib_g3) -> df_g3_vars
glimpse(df_g3_vars)
```

## G4 MW non-MSA

### Age G4

```{r}
svychisq(~Age+DentalVisit,survey_design_subset_geo4,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(Age=="<15"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_age_dent_1
extract_tbl(
  svyciprop(~I(Age=="15-24"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_age_dent_2
extract_tbl(
  svyciprop(~I(Age=="25-44"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_age_dent_3 
extract_tbl(
  svyciprop(~I(Age=="45-64"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_age_dent_4
extract_tbl(
  svyciprop(~I(Age=="65+"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_age_dent_5
extract_tbl(
  svyciprop(~I(Age=="<15"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_age_non_1
extract_tbl(
  svyciprop(~I(Age=="15-24"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_age_non_2
extract_tbl(
  svyciprop(~I(Age=="25-44"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_age_non_3
extract_tbl(
  svyciprop(~I(Age=="45-64"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_age_non_4
extract_tbl(
  svyciprop(~I(Age=="65+"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_age_non_5
bind_rows(g4_age_dent_1,
          g4_age_dent_2,
          g4_age_dent_3,
          g4_age_dent_4,
          g4_age_dent_5,
          g4_age_non_1,
          g4_age_non_2,
          g4_age_non_3,
          g4_age_non_4,
          g4_age_non_5) -> df_prop_age_g4
print(df_prop_age_g4)
```


### ResidenceType G4

```{r}
svychisq(~ResidenceType+DentalVisit,survey_design_subset_geo4,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(ResidenceType=="Unknown"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_res_dent_1
extract_tbl(
  svyciprop(~I(ResidenceType=="Private"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_res_dent_2
extract_tbl(
  svyciprop(~I(ResidenceType=="Other"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_res_dent_3 
extract_tbl(
  svyciprop(~I(ResidenceType=="Unknown"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_res_non_1
extract_tbl(
  svyciprop(~I(ResidenceType=="Private"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_res_non_2
extract_tbl(
  svyciprop(~I(ResidenceType=="Other"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_res_non_3
bind_rows(g4_res_dent_1,
          g4_res_dent_2,
          g4_res_dent_3,
          g4_res_non_1,
          g4_res_non_2,
          g4_res_non_3) -> df_prop_res_g4
print(df_prop_res_g4)
```

### Sex G4

```{r}
svychisq(~Sex+DentalVisit,survey_design_subset_geo4,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(Sex=="Female"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_sex_dent_1
extract_tbl(
  svyciprop(~I(Sex=="Male"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_sex_dent_2
extract_tbl(
  svyciprop(~I(Sex=="Female"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_sex_non_1
extract_tbl(
  svyciprop(~I(Sex=="Male"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_sex_non_2
bind_rows(g4_sex_dent_1,
          g4_sex_dent_2,
          g4_sex_non_1,
          g4_sex_non_2) -> df_prop_sex_g4
print(df_prop_sex_g4)
```


### RaceEth G4

```{r}
svytotal(~RaceEth,design=survey_design_subset_g4_dent,na.rm=FALSE)
```

```{r}
svychisq(~RaceEth+DentalVisit,survey_design_subset_geo4,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(RaceEth=="White"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_race_dent_1
extract_tbl(
  svyciprop(~I(RaceEth=="Black"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_race_dent_2
extract_tbl(
  svyciprop(~I(RaceEth=="Hisp."),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_race_dent_3
extract_tbl(
  svyciprop(~I(RaceEth=="Other"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_race_dent_4
extract_tbl(
  svyciprop(~I(RaceEth=="White"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_race_non_1
extract_tbl(
  svyciprop(~I(RaceEth=="Black"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_race_non_2
extract_tbl(
  svyciprop(~I(RaceEth=="Hisp."),
            survey_design_subset_g4_non,
            method="lo")) -> g4_race_non_3
extract_tbl(
  svyciprop(~I(RaceEth=="Other"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_race_non_4
bind_rows(g4_race_dent_1,
          g4_race_dent_2,
          g4_race_dent_3,
          g4_race_dent_4,
          g4_race_non_1,
          g4_race_non_2,
          g4_race_non_3,
          g4_race_non_4) -> df_prop_race_g4
print(df_prop_race_g4)
```


### PayerType G4

```{r}
svychisq(~PayerType+DentalVisit,survey_design_subset_geo4,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(PayerType=="Other"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_payer_dent_1
extract_tbl(
  svyciprop(~I(PayerType=="Private"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_payer_dent_2
extract_tbl(
  svyciprop(~I(PayerType=="Medicare"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_payer_dent_3
extract_tbl(
  svyciprop(~I(PayerType=="State"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_payer_dent_4
extract_tbl(
  svyciprop(~I(PayerType=="Self"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_payer_dent_5
extract_tbl(
  svyciprop(~I(PayerType=="Other"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_payer_non_1
extract_tbl(
  svyciprop(~I(PayerType=="Private"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_payer_non_2
extract_tbl(
  svyciprop(~I(PayerType=="Medicare"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_payer_non_3
extract_tbl(
  svyciprop(~I(PayerType=="State"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_payer_non_4
extract_tbl(
  svyciprop(~I(PayerType=="Self"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_payer_non_5
bind_rows(g4_payer_dent_1,
          g4_payer_dent_2,
          g4_payer_dent_3,
          g4_payer_dent_4,
          g4_payer_dent_5,
          g4_payer_non_1,
          g4_payer_non_2,
          g4_payer_non_3,
          g4_payer_non_4,
          g4_payer_non_5) -> df_prop_payer_g4
print(df_prop_payer_g4)
```

### diab_status G4

```{r}
svychisq(~diab_status+DentalVisit,survey_design_subset_geo4,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(diab_status=="No"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_diab_dent_1
extract_tbl(
  svyciprop(~I(diab_status=="Yes"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_diab_dent_2
extract_tbl(
  svyciprop(~I(diab_status=="No"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_diab_non_1
extract_tbl(
  svyciprop(~I(diab_status=="Yes"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_diab_non_2
bind_rows(g4_diab_dent_1,
          g4_diab_dent_2,
          g4_diab_non_1,
          g4_diab_non_2) -> df_prop_diab_g4
print(df_prop_diab_g4)
```

### substab_f G4

```{r}
svychisq(~substab_f+DentalVisit,survey_design_subset_geo4,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(substab_f=="No"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_subs_dent_1
extract_tbl(
  svyciprop(~I(substab_f=="Yes"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_subs_dent_2
extract_tbl(
  svyciprop(~I(substab_f=="No"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_subs_non_1
extract_tbl(
  svyciprop(~I(substab_f=="Yes"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_subs_non_2
bind_rows(g4_subs_dent_1,
          g4_subs_dent_2,
          g4_subs_non_1,
          g4_subs_non_2) -> df_prop_subs_g4
print(df_prop_subs_g4)
```

### seen72_f G4

```{r}
svychisq(~seen72_f+DentalVisit,survey_design_subset_geo4,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(seen72_f=="Unspecified"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_seen_dent_1
extract_tbl(
  svyciprop(~I(seen72_f=="No"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_seen_dent_2
extract_tbl(
  svyciprop(~I(seen72_f=="Yes"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_seen_dent_3
extract_tbl(
  svyciprop(~I(seen72_f=="Unspecified"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_seen_non_1
extract_tbl(
  svyciprop(~I(seen72_f=="No"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_seen_non_2
extract_tbl(
  svyciprop(~I(seen72_f=="Yes"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_seen_non_3
bind_rows(g4_seen_dent_1,
          g4_seen_dent_2,
          g4_seen_dent_3,
          g4_seen_non_1,
          g4_seen_non_2,
          g4_seen_non_3) -> df_prop_seen_g4
print(df_prop_seen_g4)
```

### rx_opioid G4

```{r}
svychisq(~rx_opioid+DentalVisit,survey_design_subset_geo4,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(rx_opioid=="No"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_opi_dent_1
extract_tbl(
  svyciprop(~I(rx_opioid=="Yes"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_opi_dent_2
extract_tbl(
  svyciprop(~I(rx_opioid=="No"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_opi_non_1
extract_tbl(
  svyciprop(~I(rx_opioid=="Yes"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_opi_non_2
bind_rows(g4_opi_dent_1,
          g4_opi_dent_2,
          g4_opi_non_1,
          g4_opi_non_2) -> df_prop_opi_g4
print(df_prop_opi_g4)
```

### rx_nsaid_ace G4

```{r}
svychisq(~rx_nsaid_ace+DentalVisit,survey_design_subset_geo4,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="No"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_nsaid_dent_1
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="Yes"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_nsaid_dent_2
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="No"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_nsaid_non_1
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="Yes"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_nsaid_non_2
bind_rows(g4_nsaid_dent_1,
          g4_nsaid_dent_2,
          g4_nsaid_non_1,
          g4_nsaid_non_2) -> df_prop_nsaid_g4
print(df_prop_nsaid_g4)
```

### rx_antibiotic G4

```{r}
svychisq(~rx_antibiotic+DentalVisit,survey_design_subset_geo4,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(rx_antibiotic=="No"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_antib_dent_1
extract_tbl(
  svyciprop(~I(rx_antibiotic=="Yes"),
            survey_design_subset_g4_dent,
            method="lo")) -> g4_antib_dent_2
extract_tbl(
  svyciprop(~I(rx_antibiotic=="No"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_antib_non_1
extract_tbl(
  svyciprop(~I(rx_antibiotic=="Yes"),
            survey_design_subset_g4_non,
            method="lo")) -> g4_antib_non_2
bind_rows(g4_antib_dent_1,
          g4_antib_dent_2,
          g4_antib_non_1,
          g4_antib_non_2) -> df_prop_antib_g4
print(df_prop_antib_g4)
```

### Bind G4

```{r}
bind_rows(df_prop_age_g4,df_prop_res_g4,df_prop_sex_g4,df_prop_race_g4,df_prop_payer_g4,df_prop_diab_g4,df_prop_subs_g4,df_prop_seen_g4,df_prop_opi_g4,df_prop_nsaid_g4,df_prop_antib_g4) -> df_g4_vars
glimpse(df_g4_vars)
```

## G5 S MSA

### Age G5

```{r}
svychisq(~Age+DentalVisit,survey_design_subset_geo5,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(Age=="<15"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_age_dent_1
extract_tbl(
  svyciprop(~I(Age=="15-24"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_age_dent_2
extract_tbl(
  svyciprop(~I(Age=="25-44"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_age_dent_3 
extract_tbl(
  svyciprop(~I(Age=="45-64"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_age_dent_4
extract_tbl(
  svyciprop(~I(Age=="65+"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_age_dent_5
extract_tbl(
  svyciprop(~I(Age=="<15"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_age_non_1
extract_tbl(
  svyciprop(~I(Age=="15-24"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_age_non_2
extract_tbl(
  svyciprop(~I(Age=="25-44"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_age_non_3
extract_tbl(
  svyciprop(~I(Age=="45-64"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_age_non_4
extract_tbl(
  svyciprop(~I(Age=="65+"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_age_non_5
bind_rows(g5_age_dent_1,
          g5_age_dent_2,
          g5_age_dent_3,
          g5_age_dent_4,
          g5_age_dent_5,
          g5_age_non_1,
          g5_age_non_2,
          g5_age_non_3,
          g5_age_non_4,
          g5_age_non_5) -> df_prop_age_g5
print(df_prop_age_g5)
```


### ResidenceType g5

```{r}
svychisq(~ResidenceType+DentalVisit,survey_design_subset_geo5,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(ResidenceType=="Unknown"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_res_dent_1
extract_tbl(
  svyciprop(~I(ResidenceType=="Private"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_res_dent_2
extract_tbl(
  svyciprop(~I(ResidenceType=="Other"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_res_dent_3 
extract_tbl(
  svyciprop(~I(ResidenceType=="Unknown"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_res_non_1
extract_tbl(
  svyciprop(~I(ResidenceType=="Private"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_res_non_2
extract_tbl(
  svyciprop(~I(ResidenceType=="Other"),
            survey_design_subset_g5_non,
            method="lo")) ->g5_res_non_3
bind_rows(g5_res_dent_1,
          g5_res_dent_2,
          g5_res_dent_3,
          g5_res_non_1,
          g5_res_non_2,
          g5_res_non_3) -> df_prop_res_g5
print(df_prop_res_g5)
```

### Sex G5

```{r}
svychisq(~Sex+DentalVisit,survey_design_subset_geo5,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(Sex=="Female"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_sex_dent_1
extract_tbl(
  svyciprop(~I(Sex=="Male"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_sex_dent_2
extract_tbl(
  svyciprop(~I(Sex=="Female"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_sex_non_1
extract_tbl(
  svyciprop(~I(Sex=="Male"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_sex_non_2
bind_rows(g5_sex_dent_1,
          g5_sex_dent_2,
          g5_sex_non_1,
          g5_sex_non_2) -> df_prop_sex_g5
print(df_prop_sex_g5)
```


### RaceEth G5

```{r}
svytotal(~RaceEth,design=survey_design_subset_g5_dent,na.rm=FALSE)
```

```{r}
svychisq(~RaceEth+DentalVisit,survey_design_subset_geo5,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(RaceEth=="White"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_race_dent_1
extract_tbl(
  svyciprop(~I(RaceEth=="Black"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_race_dent_2
extract_tbl(
  svyciprop(~I(RaceEth=="Hisp."),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_race_dent_3
extract_tbl(
  svyciprop(~I(RaceEth=="Other"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_race_dent_4
extract_tbl(
  svyciprop(~I(RaceEth=="White"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_race_non_1
extract_tbl(
  svyciprop(~I(RaceEth=="Black"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_race_non_2
extract_tbl(
  svyciprop(~I(RaceEth=="Hisp."),
            survey_design_subset_g5_non,
            method="lo")) -> g5_race_non_3
extract_tbl(
  svyciprop(~I(RaceEth=="Other"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_race_non_4
bind_rows(g5_race_dent_1,
          g5_race_dent_2,
          g5_race_dent_3,
          g5_race_dent_4,
          g5_race_non_1,
          g5_race_non_2,
          g5_race_non_3,
          g5_race_non_4) -> df_prop_race_g5
print(df_prop_race_g5)
```


### PayerType G5

```{r}
svychisq(~PayerType+DentalVisit,survey_design_subset_geo5,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(PayerType=="Other"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_payer_dent_1
extract_tbl(
  svyciprop(~I(PayerType=="Private"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_payer_dent_2
extract_tbl(
  svyciprop(~I(PayerType=="Medicare"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_payer_dent_3
extract_tbl(
  svyciprop(~I(PayerType=="State"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_payer_dent_4
extract_tbl(
  svyciprop(~I(PayerType=="Self"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_payer_dent_5
extract_tbl(
  svyciprop(~I(PayerType=="Other"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_payer_non_1
extract_tbl(
  svyciprop(~I(PayerType=="Private"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_payer_non_2
extract_tbl(
  svyciprop(~I(PayerType=="Medicare"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_payer_non_3
extract_tbl(
  svyciprop(~I(PayerType=="State"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_payer_non_4
extract_tbl(
  svyciprop(~I(PayerType=="Self"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_payer_non_5
bind_rows(g5_payer_dent_1,
          g5_payer_dent_2,
          g5_payer_dent_3,
          g5_payer_dent_4,
          g5_payer_dent_5,
          g5_payer_non_1,
          g5_payer_non_2,
          g5_payer_non_3,
          g5_payer_non_4,
          g5_payer_non_5) -> df_prop_payer_g5
print(df_prop_payer_g5)
```

### diab_status G5

```{r}
svychisq(~diab_status+DentalVisit,survey_design_subset_geo5,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(diab_status=="No"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_diab_dent_1
extract_tbl(
  svyciprop(~I(diab_status=="Yes"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_diab_dent_2
extract_tbl(
  svyciprop(~I(diab_status=="No"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_diab_non_1
extract_tbl(
  svyciprop(~I(diab_status=="Yes"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_diab_non_2
bind_rows(g5_diab_dent_1,
          g5_diab_dent_2,
          g5_diab_non_1,
          g5_diab_non_2) -> df_prop_diab_g5
print(df_prop_diab_g5)
```

### substab_f G5

```{r}
svychisq(~substab_f+DentalVisit,survey_design_subset_geo5,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(substab_f=="No"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_subs_dent_1
extract_tbl(
  svyciprop(~I(substab_f=="Yes"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_subs_dent_2
extract_tbl(
  svyciprop(~I(substab_f=="No"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_subs_non_1
extract_tbl(
  svyciprop(~I(substab_f=="Yes"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_subs_non_2
bind_rows(g5_subs_dent_1,
          g5_subs_dent_2,
          g5_subs_non_1,
          g5_subs_non_2) -> df_prop_subs_g5
print(df_prop_subs_g5)
```

### seen72_f G5

```{r}
svychisq(~seen72_f+DentalVisit,survey_design_subset_geo5,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(seen72_f=="Unspecified"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_seen_dent_1
extract_tbl(
  svyciprop(~I(seen72_f=="No"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_seen_dent_2
extract_tbl(
  svyciprop(~I(seen72_f=="Yes"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_seen_dent_3
extract_tbl(
  svyciprop(~I(seen72_f=="Unspecified"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_seen_non_1
extract_tbl(
  svyciprop(~I(seen72_f=="No"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_seen_non_2
extract_tbl(
  svyciprop(~I(seen72_f=="Yes"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_seen_non_3
bind_rows(g5_seen_dent_1,
          g5_seen_dent_2,
          g5_seen_dent_3,
          g5_seen_non_1,
          g5_seen_non_2,
          g5_seen_non_3) -> df_prop_seen_g5
print(df_prop_seen_g5)
```

### rx_opioid G5

```{r}
svychisq(~rx_opioid+DentalVisit,survey_design_subset_geo5,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(rx_opioid=="No"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_opi_dent_1
extract_tbl(
  svyciprop(~I(rx_opioid=="Yes"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_opi_dent_2
extract_tbl(
  svyciprop(~I(rx_opioid=="No"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_opi_non_1
extract_tbl(
  svyciprop(~I(rx_opioid=="Yes"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_opi_non_2
bind_rows(g5_opi_dent_1,
          g5_opi_dent_2,
          g5_opi_non_1,
          g5_opi_non_2) -> df_prop_opi_g5
print(df_prop_opi_g5)
```

### rx_nsaid_ace G5

```{r}
svychisq(~rx_nsaid_ace+DentalVisit,survey_design_subset_geo5,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="No"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_nsaid_dent_1
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="Yes"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_nsaid_dent_2
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="No"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_nsaid_non_1
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="Yes"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_nsaid_non_2
bind_rows(g5_nsaid_dent_1,
          g5_nsaid_dent_2,
          g5_nsaid_non_1,
          g5_nsaid_non_2) -> df_prop_nsaid_g5
print(df_prop_nsaid_g5)
```

### rx_antibiotic G5

```{r}
svychisq(~rx_antibiotic+DentalVisit,survey_design_subset_geo5,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(rx_antibiotic=="No"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_antib_dent_1
extract_tbl(
  svyciprop(~I(rx_antibiotic=="Yes"),
            survey_design_subset_g5_dent,
            method="lo")) -> g5_antib_dent_2
extract_tbl(
  svyciprop(~I(rx_antibiotic=="No"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_antib_non_1
extract_tbl(
  svyciprop(~I(rx_antibiotic=="Yes"),
            survey_design_subset_g5_non,
            method="lo")) -> g5_antib_non_2
bind_rows(g5_antib_dent_1,
          g5_antib_dent_2,
          g5_antib_non_1,
          g5_antib_non_2) -> df_prop_antib_g5
print(df_prop_antib_g5)
```

### Bind G5

```{r}
bind_rows(df_prop_age_g5,df_prop_res_g5,df_prop_sex_g5,df_prop_race_g5,df_prop_payer_g5,df_prop_diab_g5,df_prop_subs_g5,df_prop_seen_g5,df_prop_opi_g5,df_prop_nsaid_g5,df_prop_antib_g5) -> df_g5_vars
glimpse(df_g5_vars)
```

## G6 S non-MSA

### Age G6

```{r}
svychisq(~Age+DentalVisit,survey_design_subset_geo6,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(Age=="<15"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_age_dent_1
extract_tbl(
  svyciprop(~I(Age=="15-24"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_age_dent_2
extract_tbl(
  svyciprop(~I(Age=="25-44"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_age_dent_3 
extract_tbl(
  svyciprop(~I(Age=="45-64"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_age_dent_4
extract_tbl(
  svyciprop(~I(Age=="65+"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_age_dent_5
extract_tbl(
  svyciprop(~I(Age=="<15"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_age_non_1
extract_tbl(
  svyciprop(~I(Age=="15-24"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_age_non_2
extract_tbl(
  svyciprop(~I(Age=="25-44"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_age_non_3
extract_tbl(
  svyciprop(~I(Age=="45-64"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_age_non_4
extract_tbl(
  svyciprop(~I(Age=="65+"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_age_non_5
bind_rows(g6_age_dent_1,
          g6_age_dent_2,
          g6_age_dent_3,
          g6_age_dent_4,
          g6_age_dent_5,
          g6_age_non_1,
          g6_age_non_2,
          g6_age_non_3,
          g6_age_non_4,
          g6_age_non_5) -> df_prop_age_g6
print(df_prop_age_g6)
```


### ResidenceType g6

```{r}
svychisq(~ResidenceType+DentalVisit,survey_design_subset_geo6,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(ResidenceType=="Unknown"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_res_dent_1
extract_tbl(
  svyciprop(~I(ResidenceType=="Private"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_res_dent_2
extract_tbl(
  svyciprop(~I(ResidenceType=="Other"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_res_dent_3 
extract_tbl(
  svyciprop(~I(ResidenceType=="Unknown"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_res_non_1
extract_tbl(
  svyciprop(~I(ResidenceType=="Private"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_res_non_2
extract_tbl(
  svyciprop(~I(ResidenceType=="Other"),
            survey_design_subset_g6_non,
            method="lo")) ->g6_res_non_3
bind_rows(g6_res_dent_1,
          g6_res_dent_2,
          g6_res_dent_3,
          g6_res_non_1,
          g6_res_non_2,
          g6_res_non_3) -> df_prop_res_g6
print(df_prop_res_g6)
```

### Sex G6

```{r}
svychisq(~Sex+DentalVisit,survey_design_subset_geo6,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(Sex=="Female"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_sex_dent_1
extract_tbl(
  svyciprop(~I(Sex=="Male"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_sex_dent_2
extract_tbl(
  svyciprop(~I(Sex=="Female"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_sex_non_1
extract_tbl(
  svyciprop(~I(Sex=="Male"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_sex_non_2
bind_rows(g6_sex_dent_1,
          g6_sex_dent_2,
          g6_sex_non_1,
          g6_sex_non_2) -> df_prop_sex_g6
print(df_prop_sex_g6)
```


### RaceEth G6

```{r}
svytotal(~RaceEth,design=survey_design_subset_g6_dent,na.rm=FALSE)
```

```{r}
svychisq(~RaceEth+DentalVisit,survey_design_subset_geo6,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(RaceEth=="White"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_race_dent_1
extract_tbl(
  svyciprop(~I(RaceEth=="Black"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_race_dent_2
extract_tbl(
  svyciprop(~I(RaceEth=="Hisp."),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_race_dent_3
extract_tbl(
  svyciprop(~I(RaceEth=="Other"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_race_dent_4
extract_tbl(
  svyciprop(~I(RaceEth=="White"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_race_non_1
extract_tbl(
  svyciprop(~I(RaceEth=="Black"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_race_non_2
extract_tbl(
  svyciprop(~I(RaceEth=="Hisp."),
            survey_design_subset_g6_non,
            method="lo")) -> g6_race_non_3
extract_tbl(
  svyciprop(~I(RaceEth=="Other"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_race_non_4
bind_rows(g6_race_dent_1,
          g6_race_dent_2,
          g6_race_dent_3,
          g6_race_dent_4,
          g6_race_non_1,
          g6_race_non_2,
          g6_race_non_3,
          g6_race_non_4) -> df_prop_race_g6
print(df_prop_race_g6)
```


### PayerType G6

```{r}
svychisq(~PayerType+DentalVisit,survey_design_subset_geo6,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(PayerType=="Other"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_payer_dent_1
extract_tbl(
  svyciprop(~I(PayerType=="Private"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_payer_dent_2
extract_tbl(
  svyciprop(~I(PayerType=="Medicare"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_payer_dent_3
extract_tbl(
  svyciprop(~I(PayerType=="State"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_payer_dent_4
extract_tbl(
  svyciprop(~I(PayerType=="Self"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_payer_dent_5
extract_tbl(
  svyciprop(~I(PayerType=="Other"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_payer_non_1
extract_tbl(
  svyciprop(~I(PayerType=="Private"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_payer_non_2
extract_tbl(
  svyciprop(~I(PayerType=="Medicare"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_payer_non_3
extract_tbl(
  svyciprop(~I(PayerType=="State"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_payer_non_4
extract_tbl(
  svyciprop(~I(PayerType=="Self"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_payer_non_5
bind_rows(g6_payer_dent_1,
          g6_payer_dent_2,
          g6_payer_dent_3,
          g6_payer_dent_4,
          g6_payer_dent_5,
          g6_payer_non_1,
          g6_payer_non_2,
          g6_payer_non_3,
          g6_payer_non_4,
          g6_payer_non_5) -> df_prop_payer_g6
print(df_prop_payer_g6)
```

### diab_status G6

```{r}
svychisq(~diab_status+DentalVisit,survey_design_subset_geo6,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(diab_status=="No"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_diab_dent_1
extract_tbl(
  svyciprop(~I(diab_status=="Yes"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_diab_dent_2
extract_tbl(
  svyciprop(~I(diab_status=="No"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_diab_non_1
extract_tbl(
  svyciprop(~I(diab_status=="Yes"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_diab_non_2
bind_rows(g6_diab_dent_1,
          g6_diab_dent_2,
          g6_diab_non_1,
          g6_diab_non_2) -> df_prop_diab_g6
print(df_prop_diab_g6)
```

### substab_f G6

```{r}
svychisq(~substab_f+DentalVisit,survey_design_subset_geo6,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(substab_f=="No"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_subs_dent_1
extract_tbl(
  svyciprop(~I(substab_f=="Yes"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_subs_dent_2
extract_tbl(
  svyciprop(~I(substab_f=="No"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_subs_non_1
extract_tbl(
  svyciprop(~I(substab_f=="Yes"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_subs_non_2
bind_rows(g6_subs_dent_1,
          g6_subs_dent_2,
          g6_subs_non_1,
          g6_subs_non_2) -> df_prop_subs_g6
print(df_prop_subs_g6)
```

### seen72_f G6

```{r}
svychisq(~seen72_f+DentalVisit,survey_design_subset_geo6,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(seen72_f=="Unspecified"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_seen_dent_1
extract_tbl(
  svyciprop(~I(seen72_f=="No"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_seen_dent_2
extract_tbl(
  svyciprop(~I(seen72_f=="Yes"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_seen_dent_3
extract_tbl(
  svyciprop(~I(seen72_f=="Unspecified"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_seen_non_1
extract_tbl(
  svyciprop(~I(seen72_f=="No"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_seen_non_2
extract_tbl(
  svyciprop(~I(seen72_f=="Yes"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_seen_non_3
bind_rows(g6_seen_dent_1,
          g6_seen_dent_2,
          g6_seen_dent_3,
          g6_seen_non_1,
          g6_seen_non_2,
          g6_seen_non_3) -> df_prop_seen_g6
print(df_prop_seen_g6)
```

### rx_opioid G6

```{r}
svychisq(~rx_opioid+DentalVisit,survey_design_subset_geo6,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(rx_opioid=="No"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_opi_dent_1
extract_tbl(
  svyciprop(~I(rx_opioid=="Yes"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_opi_dent_2
extract_tbl(
  svyciprop(~I(rx_opioid=="No"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_opi_non_1
extract_tbl(
  svyciprop(~I(rx_opioid=="Yes"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_opi_non_2
bind_rows(g6_opi_dent_1,
          g6_opi_dent_2,
          g6_opi_non_1,
          g6_opi_non_2) -> df_prop_opi_g6
print(df_prop_opi_g6)
```

### rx_nsaid_ace G6

```{r}
svychisq(~rx_nsaid_ace+DentalVisit,survey_design_subset_geo6,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="No"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_nsaid_dent_1
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="Yes"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_nsaid_dent_2
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="No"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_nsaid_non_1
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="Yes"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_nsaid_non_2
bind_rows(g6_nsaid_dent_1,
          g6_nsaid_dent_2,
          g6_nsaid_non_1,
          g6_nsaid_non_2) -> df_prop_nsaid_g6
print(df_prop_nsaid_g6)
```

### rx_antibiotic G6

```{r}
svychisq(~rx_antibiotic+DentalVisit,survey_design_subset_geo6,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(rx_antibiotic=="No"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_antib_dent_1
extract_tbl(
  svyciprop(~I(rx_antibiotic=="Yes"),
            survey_design_subset_g6_dent,
            method="lo")) -> g6_antib_dent_2
extract_tbl(
  svyciprop(~I(rx_antibiotic=="No"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_antib_non_1
extract_tbl(
  svyciprop(~I(rx_antibiotic=="Yes"),
            survey_design_subset_g6_non,
            method="lo")) -> g6_antib_non_2
bind_rows(g6_antib_dent_1,
          g6_antib_dent_2,
          g6_antib_non_1,
          g6_antib_non_2) -> df_prop_antib_g6
print(df_prop_antib_g6)
```

### Bind G6

```{r}
bind_rows(df_prop_age_g6,df_prop_res_g6,df_prop_sex_g6,df_prop_race_g6,df_prop_payer_g6,df_prop_diab_g6,df_prop_subs_g6,df_prop_seen_g6,df_prop_opi_g6,df_prop_nsaid_g6,df_prop_antib_g6) -> df_g6_vars
glimpse(df_g6_vars)
```

## G7 W MSA

### Age G7

```{r}
svychisq(~Age+DentalVisit,survey_design_subset_geo7,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(Age=="<15"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_age_dent_1
extract_tbl(
  svyciprop(~I(Age=="15-24"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_age_dent_2
extract_tbl(
  svyciprop(~I(Age=="25-44"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_age_dent_3 
extract_tbl(
  svyciprop(~I(Age=="45-64"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_age_dent_4
extract_tbl(
  svyciprop(~I(Age=="65+"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_age_dent_5
extract_tbl(
  svyciprop(~I(Age=="<15"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_age_non_1
extract_tbl(
  svyciprop(~I(Age=="15-24"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_age_non_2
extract_tbl(
  svyciprop(~I(Age=="25-44"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_age_non_3
extract_tbl(
  svyciprop(~I(Age=="45-64"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_age_non_4
extract_tbl(
  svyciprop(~I(Age=="65+"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_age_non_5
bind_rows(g7_age_dent_1,
          g7_age_dent_2,
          g7_age_dent_3,
          g7_age_dent_4,
          g7_age_dent_5,
          g7_age_non_1,
          g7_age_non_2,
          g7_age_non_3,
          g7_age_non_4,
          g7_age_non_5) -> df_prop_age_g7
print(df_prop_age_g7)
```


### ResidenceType g7

```{r}
svychisq(~ResidenceType+DentalVisit,survey_design_subset_geo7,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(ResidenceType=="Unknown"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_res_dent_1
extract_tbl(
  svyciprop(~I(ResidenceType=="Private"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_res_dent_2
extract_tbl(
  svyciprop(~I(ResidenceType=="Other"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_res_dent_3 
extract_tbl(
  svyciprop(~I(ResidenceType=="Unknown"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_res_non_1
extract_tbl(
  svyciprop(~I(ResidenceType=="Private"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_res_non_2
extract_tbl(
  svyciprop(~I(ResidenceType=="Other"),
            survey_design_subset_g7_non,
            method="lo")) ->g7_res_non_3
bind_rows(g7_res_dent_1,
          g7_res_dent_2,
          g7_res_dent_3,
          g7_res_non_1,
          g7_res_non_2,
          g7_res_non_3) -> df_prop_res_g7
print(df_prop_res_g7)
```

### Sex G7

```{r}
svychisq(~Sex+DentalVisit,survey_design_subset_geo7,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(Sex=="Female"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_sex_dent_1
extract_tbl(
  svyciprop(~I(Sex=="Male"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_sex_dent_2
extract_tbl(
  svyciprop(~I(Sex=="Female"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_sex_non_1
extract_tbl(
  svyciprop(~I(Sex=="Male"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_sex_non_2
bind_rows(g7_sex_dent_1,
          g7_sex_dent_2,
          g7_sex_non_1,
          g7_sex_non_2) -> df_prop_sex_g7
print(df_prop_sex_g7)
```


### RaceEth G7

```{r}
svytotal(~RaceEth,design=survey_design_subset_g7_dent,na.rm=FALSE)
```

```{r}
svychisq(~RaceEth+DentalVisit,survey_design_subset_geo7,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(RaceEth=="White"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_race_dent_1
extract_tbl(
  svyciprop(~I(RaceEth=="Black"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_race_dent_2
extract_tbl(
  svyciprop(~I(RaceEth=="Hisp."),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_race_dent_3
extract_tbl(
  svyciprop(~I(RaceEth=="Other"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_race_dent_4
extract_tbl(
  svyciprop(~I(RaceEth=="White"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_race_non_1
extract_tbl(
  svyciprop(~I(RaceEth=="Black"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_race_non_2
extract_tbl(
  svyciprop(~I(RaceEth=="Hisp."),
            survey_design_subset_g7_non,
            method="lo")) -> g7_race_non_3
extract_tbl(
  svyciprop(~I(RaceEth=="Other"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_race_non_4
bind_rows(g7_race_dent_1,
          g7_race_dent_2,
          g7_race_dent_3,
          g7_race_dent_4,
          g7_race_non_1,
          g7_race_non_2,
          g7_race_non_3,
          g7_race_non_4) -> df_prop_race_g7
print(df_prop_race_g7)
```


### PayerType G7

```{r}
svychisq(~PayerType+DentalVisit,survey_design_subset_geo7,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(PayerType=="Other"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_payer_dent_1
extract_tbl(
  svyciprop(~I(PayerType=="Private"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_payer_dent_2
extract_tbl(
  svyciprop(~I(PayerType=="Medicare"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_payer_dent_3
extract_tbl(
  svyciprop(~I(PayerType=="State"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_payer_dent_4
extract_tbl(
  svyciprop(~I(PayerType=="Self"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_payer_dent_5
extract_tbl(
  svyciprop(~I(PayerType=="Other"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_payer_non_1
extract_tbl(
  svyciprop(~I(PayerType=="Private"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_payer_non_2
extract_tbl(
  svyciprop(~I(PayerType=="Medicare"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_payer_non_3
extract_tbl(
  svyciprop(~I(PayerType=="State"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_payer_non_4
extract_tbl(
  svyciprop(~I(PayerType=="Self"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_payer_non_5
bind_rows(g7_payer_dent_1,
          g7_payer_dent_2,
          g7_payer_dent_3,
          g7_payer_dent_4,
          g7_payer_dent_5,
          g7_payer_non_1,
          g7_payer_non_2,
          g7_payer_non_3,
          g7_payer_non_4,
          g7_payer_non_5) -> df_prop_payer_g7
print(df_prop_payer_g7)
```

### diab_status G7

```{r}
svychisq(~diab_status+DentalVisit,survey_design_subset_geo7,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(diab_status=="No"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_diab_dent_1
extract_tbl(
  svyciprop(~I(diab_status=="Yes"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_diab_dent_2
extract_tbl(
  svyciprop(~I(diab_status=="No"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_diab_non_1
extract_tbl(
  svyciprop(~I(diab_status=="Yes"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_diab_non_2
bind_rows(g7_diab_dent_1,
          g7_diab_dent_2,
          g7_diab_non_1,
          g7_diab_non_2) -> df_prop_diab_g7
print(df_prop_diab_g7)
```

### substab_f G7

```{r}
svychisq(~substab_f+DentalVisit,survey_design_subset_geo7,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(substab_f=="No"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_subs_dent_1
extract_tbl(
  svyciprop(~I(substab_f=="Yes"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_subs_dent_2
extract_tbl(
  svyciprop(~I(substab_f=="No"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_subs_non_1
extract_tbl(
  svyciprop(~I(substab_f=="Yes"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_subs_non_2
bind_rows(g7_subs_dent_1,
          g7_subs_dent_2,
          g7_subs_non_1,
          g7_subs_non_2) -> df_prop_subs_g7
print(df_prop_subs_g7)
```

### seen72_f G7

```{r}
svychisq(~seen72_f+DentalVisit,survey_design_subset_geo7,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(seen72_f=="Unspecified"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_seen_dent_1
extract_tbl(
  svyciprop(~I(seen72_f=="No"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_seen_dent_2
extract_tbl(
  svyciprop(~I(seen72_f=="Yes"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_seen_dent_3
extract_tbl(
  svyciprop(~I(seen72_f=="Unspecified"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_seen_non_1
extract_tbl(
  svyciprop(~I(seen72_f=="No"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_seen_non_2
extract_tbl(
  svyciprop(~I(seen72_f=="Yes"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_seen_non_3
bind_rows(g7_seen_dent_1,
          g7_seen_dent_2,
          g7_seen_dent_3,
          g7_seen_non_1,
          g7_seen_non_2,
          g7_seen_non_3) -> df_prop_seen_g7
print(df_prop_seen_g7)
```

### rx_opioid G7

```{r}
svychisq(~rx_opioid+DentalVisit,survey_design_subset_geo7,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(rx_opioid=="No"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_opi_dent_1
extract_tbl(
  svyciprop(~I(rx_opioid=="Yes"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_opi_dent_2
extract_tbl(
  svyciprop(~I(rx_opioid=="No"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_opi_non_1
extract_tbl(
  svyciprop(~I(rx_opioid=="Yes"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_opi_non_2
bind_rows(g7_opi_dent_1,
          g7_opi_dent_2,
          g7_opi_non_1,
          g7_opi_non_2) -> df_prop_opi_g7
print(df_prop_opi_g7)
```

### rx_nsaid_ace G7

```{r}
svychisq(~rx_nsaid_ace+DentalVisit,survey_design_subset_geo7,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="No"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_nsaid_dent_1
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="Yes"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_nsaid_dent_2
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="No"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_nsaid_non_1
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="Yes"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_nsaid_non_2
bind_rows(g7_nsaid_dent_1,
          g7_nsaid_dent_2,
          g7_nsaid_non_1,
          g7_nsaid_non_2) -> df_prop_nsaid_g7
print(df_prop_nsaid_g7)
```

### rx_antibiotic G7

```{r}
svychisq(~rx_antibiotic+DentalVisit,survey_design_subset_geo7,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(rx_antibiotic=="No"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_antib_dent_1
extract_tbl(
  svyciprop(~I(rx_antibiotic=="Yes"),
            survey_design_subset_g7_dent,
            method="lo")) -> g7_antib_dent_2
extract_tbl(
  svyciprop(~I(rx_antibiotic=="No"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_antib_non_1
extract_tbl(
  svyciprop(~I(rx_antibiotic=="Yes"),
            survey_design_subset_g7_non,
            method="lo")) -> g7_antib_non_2
bind_rows(g7_antib_dent_1,
          g7_antib_dent_2,
          g7_antib_non_1,
          g7_antib_non_2) -> df_prop_antib_g7
print(df_prop_antib_g7)
```

### Bind G7

```{r}
bind_rows(df_prop_age_g7,df_prop_res_g7,df_prop_sex_g7,df_prop_race_g7,df_prop_payer_g7,df_prop_diab_g7,df_prop_subs_g7,df_prop_seen_g7,df_prop_opi_g7,df_prop_nsaid_g7,df_prop_antib_g7) -> df_g7_vars
glimpse(df_g7_vars)
```


## G8 W non-MSA

### Age G8

```{r}
#svychisq(~Age+DentalVisit,survey_design_subset_geo8,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(Age=="<15"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_age_dent_1
extract_tbl(
  svyciprop(~I(Age=="15-24"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_age_dent_2
extract_tbl(
  svyciprop(~I(Age=="25-44"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_age_dent_3 
extract_tbl(
  svyciprop(~I(Age=="45-64"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_age_dent_4
extract_tbl(
  svyciprop(~I(Age=="65+"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_age_dent_5
extract_tbl(
  svyciprop(~I(Age=="<15"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_age_non_1
extract_tbl(
  svyciprop(~I(Age=="15-24"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_age_non_2
extract_tbl(
  svyciprop(~I(Age=="25-44"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_age_non_3
extract_tbl(
  svyciprop(~I(Age=="45-64"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_age_non_4
extract_tbl(
  svyciprop(~I(Age=="65+"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_age_non_5
bind_rows(g8_age_dent_1,
          g8_age_dent_2,
          g8_age_dent_3,
          g8_age_dent_4,
          g8_age_dent_5,
          g8_age_non_1,
          g8_age_non_2,
          g8_age_non_3,
          g8_age_non_4,
          g8_age_non_5) -> df_prop_age_g8
print(df_prop_age_g8)
```


### ResidenceType g8

```{r}
svychisq(~ResidenceType+DentalVisit,survey_design_subset_geo8,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(ResidenceType=="Unknown"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_res_dent_1
extract_tbl(
  svyciprop(~I(ResidenceType=="Private"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_res_dent_2
extract_tbl(
  svyciprop(~I(ResidenceType=="Other"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_res_dent_3 
extract_tbl(
  svyciprop(~I(ResidenceType=="Unknown"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_res_non_1
extract_tbl(
  svyciprop(~I(ResidenceType=="Private"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_res_non_2
extract_tbl(
  svyciprop(~I(ResidenceType=="Other"),
            survey_design_subset_g8_non,
            method="lo")) ->g8_res_non_3
bind_rows(g8_res_dent_1,
          g8_res_dent_2,
          g8_res_dent_3,
          g8_res_non_1,
          g8_res_non_2,
          g8_res_non_3) -> df_prop_res_g8
print(df_prop_res_g8)
```

### Sex G8

```{r}
svychisq(~Sex+DentalVisit,survey_design_subset_geo8,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(Sex=="Female"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_sex_dent_1
extract_tbl(
  svyciprop(~I(Sex=="Male"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_sex_dent_2
extract_tbl(
  svyciprop(~I(Sex=="Female"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_sex_non_1
extract_tbl(
  svyciprop(~I(Sex=="Male"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_sex_non_2
bind_rows(g8_sex_dent_1,
          g8_sex_dent_2,
          g8_sex_non_1,
          g8_sex_non_2) -> df_prop_sex_g8
print(df_prop_sex_g8)
```


### RaceEth G8

```{r}
svytotal(~RaceEth,design=survey_design_subset_g8_dent,na.rm=FALSE)
```

```{r}
#svychisq(~RaceEth+DentalVisit,survey_design_subset_geo8,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(RaceEth=="White"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_race_dent_1
extract_tbl(
  svyciprop(~I(RaceEth=="Black"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_race_dent_2
extract_tbl(
  svyciprop(~I(RaceEth=="Hisp."),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_race_dent_3
extract_tbl(
  svyciprop(~I(RaceEth=="Other"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_race_dent_4
extract_tbl(
  svyciprop(~I(RaceEth=="White"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_race_non_1
extract_tbl(
  svyciprop(~I(RaceEth=="Black"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_race_non_2
extract_tbl(
  svyciprop(~I(RaceEth=="Hisp."),
            survey_design_subset_g8_non,
            method="lo")) -> g8_race_non_3
extract_tbl(
  svyciprop(~I(RaceEth=="Other"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_race_non_4
bind_rows(g8_race_dent_1,
          g8_race_dent_2,
          g8_race_dent_3,
          g8_race_dent_4,
          g8_race_non_1,
          g8_race_non_2,
          g8_race_non_3,
          g8_race_non_4) -> df_prop_race_g8
print(df_prop_race_g8)
```


### PayerType G8

```{r}
#svychisq(~PayerType+DentalVisit,survey_design_subset_geo8,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(PayerType=="Other"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_payer_dent_1
extract_tbl(
  svyciprop(~I(PayerType=="Private"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_payer_dent_2
extract_tbl(
  svyciprop(~I(PayerType=="Medicare"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_payer_dent_3
extract_tbl(
  svyciprop(~I(PayerType=="State"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_payer_dent_4
extract_tbl(
  svyciprop(~I(PayerType=="Self"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_payer_dent_5
extract_tbl(
  svyciprop(~I(PayerType=="Other"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_payer_non_1
extract_tbl(
  svyciprop(~I(PayerType=="Private"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_payer_non_2
extract_tbl(
  svyciprop(~I(PayerType=="Medicare"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_payer_non_3
extract_tbl(
  svyciprop(~I(PayerType=="State"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_payer_non_4
extract_tbl(
  svyciprop(~I(PayerType=="Self"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_payer_non_5
bind_rows(g8_payer_dent_1,
          g8_payer_dent_2,
          g8_payer_dent_3,
          g8_payer_dent_4,
          g8_payer_dent_5,
          g8_payer_non_1,
          g8_payer_non_2,
          g8_payer_non_3,
          g8_payer_non_4,
          g8_payer_non_5) -> df_prop_payer_g8
print(df_prop_payer_g8)
```

### diab_status G8

```{r}
svychisq(~diab_status+DentalVisit,survey_design_subset_geo8,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(diab_status=="No"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_diab_dent_1
extract_tbl(
  svyciprop(~I(diab_status=="Yes"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_diab_dent_2
extract_tbl(
  svyciprop(~I(diab_status=="No"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_diab_non_1
extract_tbl(
  svyciprop(~I(diab_status=="Yes"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_diab_non_2
bind_rows(g8_diab_dent_1,
          g8_diab_dent_2,
          g8_diab_non_1,
          g8_diab_non_2) -> df_prop_diab_g8
print(df_prop_diab_g8)
```

### substab_f G8

```{r}
svychisq(~substab_f+DentalVisit,survey_design_subset_geo8,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(substab_f=="No"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_subs_dent_1
extract_tbl(
  svyciprop(~I(substab_f=="Yes"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_subs_dent_2
extract_tbl(
  svyciprop(~I(substab_f=="No"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_subs_non_1
extract_tbl(
  svyciprop(~I(substab_f=="Yes"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_subs_non_2
bind_rows(g8_subs_dent_1,
          g8_subs_dent_2,
          g8_subs_non_1,
          g8_subs_non_2) -> df_prop_subs_g8
print(df_prop_subs_g8)
```

### seen72_f G8

```{r}
svychisq(~seen72_f+DentalVisit,survey_design_subset_geo8,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(seen72_f=="Unspecified"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_seen_dent_1
extract_tbl(
  svyciprop(~I(seen72_f=="No"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_seen_dent_2
extract_tbl(
  svyciprop(~I(seen72_f=="Yes"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_seen_dent_3
extract_tbl(
  svyciprop(~I(seen72_f=="Unspecified"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_seen_non_1
extract_tbl(
  svyciprop(~I(seen72_f=="No"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_seen_non_2
extract_tbl(
  svyciprop(~I(seen72_f=="Yes"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_seen_non_3
bind_rows(g8_seen_dent_1,
          g8_seen_dent_2,
          g8_seen_dent_3,
          g8_seen_non_1,
          g8_seen_non_2,
          g8_seen_non_3) -> df_prop_seen_g8
print(df_prop_seen_g8)
```

### rx_opioid G8

```{r}
svychisq(~rx_opioid+DentalVisit,survey_design_subset_geo8,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(rx_opioid=="No"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_opi_dent_1
extract_tbl(
  svyciprop(~I(rx_opioid=="Yes"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_opi_dent_2
extract_tbl(
  svyciprop(~I(rx_opioid=="No"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_opi_non_1
extract_tbl(
  svyciprop(~I(rx_opioid=="Yes"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_opi_non_2
bind_rows(g8_opi_dent_1,
          g8_opi_dent_2,
          g8_opi_non_1,
          g8_opi_non_2) -> df_prop_opi_g8
print(df_prop_opi_g8)
```

### rx_nsaid_ace G8

```{r}
svychisq(~rx_nsaid_ace+DentalVisit,survey_design_subset_geo8,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="No"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_nsaid_dent_1
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="Yes"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_nsaid_dent_2
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="No"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_nsaid_non_1
extract_tbl(
  svyciprop(~I(rx_nsaid_ace=="Yes"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_nsaid_non_2
bind_rows(g8_nsaid_dent_1,
          g8_nsaid_dent_2,
          g8_nsaid_non_1,
          g8_nsaid_non_2) -> df_prop_nsaid_g8
print(df_prop_nsaid_g8)
```

### rx_antibiotic G8

```{r}
svychisq(~rx_antibiotic+DentalVisit,survey_design_subset_geo8,statistic="Wald")
```

```{r}
extract_tbl(
  svyciprop(~I(rx_antibiotic=="No"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_antib_dent_1
extract_tbl(
  svyciprop(~I(rx_antibiotic=="Yes"),
            survey_design_subset_g8_dent,
            method="lo")) -> g8_antib_dent_2
extract_tbl(
  svyciprop(~I(rx_antibiotic=="No"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_antib_non_1
extract_tbl(
  svyciprop(~I(rx_antibiotic=="Yes"),
            survey_design_subset_g8_non,
            method="lo")) -> g8_antib_non_2
bind_rows(g8_antib_dent_1,
          g8_antib_dent_2,
          g8_antib_non_1,
          g8_antib_non_2) -> df_prop_antib_g8
print(df_prop_antib_g8)
```

### Bind G8

```{r}
bind_rows(df_prop_age_g8,df_prop_res_g8,df_prop_sex_g8,df_prop_race_g8,df_prop_payer_g8,df_prop_diab_g8,df_prop_subs_g8,df_prop_seen_g8,df_prop_opi_g8,df_prop_nsaid_g8,df_prop_antib_g8) -> df_g8_vars
glimpse(df_g8_vars)
```

## Export Descriptive Tables

```{r}
write_csv(df_g1_vars,"output_g1.csv")
write_csv(df_g2_vars,"output_g2.csv")
write_csv(df_g3_vars,"output_g3.csv")
write_csv(df_g4_vars,"output_g4.csv")
write_csv(df_g5_vars,"output_g5.csv")
write_csv(df_g6_vars,"output_g6.csv")
write_csv(df_g7_vars,"output_g7.csv")
write_csv(df_g8_vars,"output_g8.csv")
```

# Data Visualization

## Bar Charts

### DentalVisits

```{r plot bar ntdc all}
ggbarweight_svy(survey_design_ref,
                DentalVisit,
                fill=TRUE) +
  labs(
    title="Comparison of Preventable Dental Visits to Other Types",
    x="Visit Type",
    y="Proportion of Total Visits") -> plot_bar_ntdc_all
plot_bar_ntdc_all
```

### Year

```{r plot bar year all}
ggbarweight_svy(survey_design_ref,
                Year,
                fill=TRUE) +
  scale_fill_brewer(palette = "Set2") +
  labs(
    title="Distribution of Visits per NHAMCS Survey Year",
    x="Survey Year",
    y="Proportion of Total Visits") -> plot_bar_year_all
plot_bar_year_all
```

```{r plot bar year subset ntdc}
ggbarweight_svy(survey_design_subset_ntdc,
                Year,
                fill=TRUE) +
  scale_fill_brewer(palette = "Set2") +
  labs(
    title="Distribution of Preventable Dental Visits per NHAMCS Survey Year",
    x="Survey Year",
    y="Proportion of Dental Visits") -> plot_bar_year_subset_ntdc
plot_bar_year_subset_ntdc
```

### geo_strata
          
```{r plot bar geo all}
ggbarweight_svy(survey_design,
                geo_strata,
                fill=TRUE) +
  scale_fill_brewer(palette="Paired") +
  labs(
    title="Total Visits by Geographic Strata",
    x="Geographic Strata",
    y="Proportion of Total Visits") -> plot_bar_geo_all
plot_bar_geo_all
```

```{r plot bar geo noncase}
ggbarweight_svy(survey_design_subset_noncase,
                geo_strata,
                fill=TRUE) +
  scale_fill_brewer(palette="Paired") +
  labs(
    title="Other Visits by Geographic Strata (Excl. Dental)",
    x="Geographic Strata",
    y="Proportion of Other Visits") -> plot_bar_geo_noncase
plot_bar_geo_noncase
```

```{r plot bar geo subset ntdc}
ggbarweight_svy(survey_design_subset_ntdc,
                geo_strata,
                fill=TRUE) +
  scale_fill_brewer(palette="Paired") +
  labs(
    title="Nontraumatic Dental Visits by Geographic Strata",
    subtitle = "p = 0.077",
    x="Geographic Strata",
    y="Proportion of Dental Visits") -> plot_bar_geo_subset_ntdc
plot_bar_geo_subset_ntdc
```

## Crosstab Bar Charts

### geographic strata

```{r plot bar cross geo x ntdc}
ggbarcrosstabs(df_ref,geo_strata,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Paired") +
  labs(
    title="Comparing Visit Distribution By Geography",
    x="Region & MSA Combined Strata",
    y="Proportion of Visits"
    ) -> plot_bar_cross_geo
plot_bar_cross_geo
```

### ager_f

```{r plot bar crosstab ager_f x ntdc}
ggbarcrosstabs(df_select_factored,ager_f,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Comparing Visit Distribution by Patient Age (6 Groups)",
    subtitle = "p < 0.001",
    x="Patient Age Group",
    y="Proportion of Visits"
    ) -> plot_bar_cross_age
plot_bar_cross_age
```

### Age

```{r plot bar crosstab Age x ntdc}
ggbarcrosstabs(df_ref,Age,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Comparing Visit Distribution by Patient Age",
    subtitle = "p < 0.001",
    x="Patient Age Group",
    y="Proportion of Visits"
    ) -> plot_bar_cross_age2
plot_bar_cross_age2
```


### residnce_f

```{r plot bar crosstab residnce_f x ntdc}
ggbarcrosstabs(df_ref,residnce_f,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Comparing Visit Distribution by Patient Residence Type (All levels)",
    subtitle = "p < 0.001",
    x="Residence Type",
    y="Proportion of Visits"
    ) -> plot_bar_cross_residnce
plot_bar_cross_residnce
```

### ResidenceType

```{r plot bar crosstab ResidenceType x ntdc}
ggbarcrosstabs(df_ref,ResidenceType,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Comparing Visit Distribution by Patient Residence Type (Binary)",
    subtitle = "p < 0.001",
    x="Residence Type",
    y="Proportion of Visits"
    ) -> plot_bar_cross_residnce2
plot_bar_cross_residnce2
```


### Sex

```{r plot bar crosstab Sex x ntdc}
ggbarcrosstabs(df_ref,Sex,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Comparing Visit Distribution by Patient Sex",
    subtitle = "p = 0.57",
    x="Patient Sex",
    y="Proportion of Visits"
    ) -> plot_bar_cross_sex
plot_bar_cross_sex
```

### RaceEth

```{r plot bar crosstab RaceEth x ntdc}
ggbarcrosstabs(df_ref,RaceEth,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Comparing Visit Distribution by Patient Race & Ethnicity",
    subtitle = "p < 0.001",
    x="Patient Race & Ethnicity",
    y="Proportion of Visits"
    ) -> plot_bar_cross_racereth
plot_bar_cross_racereth
```

### PayerType

```{r plot bar crosstab PayerType x ntdc}
ggbarcrosstabs(df_ref,PayerType,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Comparing Visit Distribution by Payer Type",
    subtitle = "p < 0.001",
    x="Visit Payer Type",
    y="Proportion of Visits"
    ) -> plot_bar_cross_paytyper
plot_bar_cross_paytyper
```

### diab_status

```{r plot bar crosstab diab_status x ntdc}
ggbarcrosstabs(df_ref,diab_status,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Comparing Visit Distribution by Patient Diabetic Status",
    subtitle = "p < 0.001",
    x="Diabetic Status",
    y="Proportion of Visits"
    ) -> plot_bar_cross_diab
plot_bar_cross_diab
```

### substab_f

```{r plot bar crosstab substab_f x ntdc}
ggbarcrosstabs(df_ref,substab_f,DentalVisit,PATWT,fill=TRUE) +

  scale_fill_brewer(palette="Set2") +
  labs(
    title="Comparing Visit Distribution by Patient History of Substance Use",
    subtitle = "p = 0.79",
    x="History of Substance Use",
    y="Proportion of Visits"
    ) -> plot_bar_cross_substab
plot_bar_cross_substab
```

### seen72_f

```{r plot bar crosstab seen72_f x ntdc}
ggbarcrosstabs(df_ref,seen72_f,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Comparing Proportion of Return Visits within 72 Hours",
    subtitle = "p = 0.25",
    x="Patient seen within 72 hours?",
    y="Proportion of Visits"
    ) -> plot_bar_cross_seen
plot_bar_cross_seen
```

### rx_opioid

```{r plot bar crosstab rx_opioid x ntdc}
ggbarcrosstabs(df_ref,rx_opioid,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Comparing Opioid Prescribing Practices",
    subtitle = "p < 0.001",
    x="Opioid Prescribed During Visit",
    y="Proportion of Visits"
    ) -> plot_bar_cross_opioid
plot_bar_cross_opioid
```

### rx_nsaid_ace

```{r plot bar crosstab rx_nsaid_ace x ntdc}
ggbarcrosstabs(df_ref,rx_nsaid_ace,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Comparing NSAID & Acetaminophen Prescribing Practices",
    subtitle = "p < 0.001",
    x="NSAID and/or Acetaminophen Prescribed During Visit",
    y="Proportion of Visits"
    ) -> plot_bar_cross_nsaid
plot_bar_cross_nsaid
```

### rx_antibiotic

```{r plot bar crosstab rx_antibiotic x ntdc}
ggbarcrosstabs(df_ref,rx_antibiotic,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Comparing Antibiotic Prescribing Practices",
    subtitle = "p < 0.001",
    x="Antibiotic Prescribed During Visit",
    y="Proportion of Visits"
    ) -> plot_bar_cross_antibiotic
plot_bar_cross_antibiotic
```

## Pie Charts

### ntdc

```{r plot pie ntdc all}
df_prop_ntdc_all <- data.frame(
  Category=c("No","Yes"),
  value=c(99,1)
)
ggplot(df_prop_ntdc_all,
       aes(x="",
         y=value,
         fill=Category)) +
  geom_bar(stat="identity",
           width=1) +
  scale_fill_grey() +
  coord_polar(theta="y") +
  theme_void() +
  labs(title="Proportion of Visits for NTDC") -> plot_pie_ntdc
plot_pie_ntdc
```

### rx_opioid

```{r plot pie rx_opioid noncase}
df_prop_opioid_noncase <- data.frame(
  Category=c("No","Yes"),
  value=c(87,13)
)
ggplot(df_prop_opioid_noncase,
       aes(x="",
         y=value,
         fill=Category)) +
  geom_bar(stat="identity",
           width=1) +
  scale_fill_brewer(palette="YlOrRd") +
  coord_polar(theta="y") +
  theme_void() +
  labs(title="Other Visits: Was an opioid prescribed during the visit?") -> plot_pie_opioid_noncase
plot_pie_opioid_noncase
```

```{r plot pie rx_opioid subset ntdc}
df_prop_opioid_subset_ntdc <- data.frame(
  Category=c("No","Yes"),
  value=c(71,29)
)
ggplot(df_prop_opioid_subset_ntdc,
       aes(x="",
         y=value,
         fill=Category)) +
  geom_bar(stat="identity",
           width=1) +
  scale_fill_brewer(palette="YlOrRd") +
  coord_polar(theta="y") +
  theme_void() +
  labs(title="Dental Visit: Was an opioid prescribed during the visit?") -> plot_pie_opioid_ntdc
plot_pie_opioid_ntdc
```

### rx_nsaid_ace

```{r plot pie rx_nsaid_ace noncase}
df_prop_nsaid_noncase <- data.frame(
  Category=c("No","Yes"),
  value=c(70,30)
)
ggplot(df_prop_nsaid_noncase,
       aes(x="",
         y=value,
         fill=Category)) +
  geom_bar(stat="identity",
           width=1) +
  scale_fill_brewer(palette="YlOrRd") +
  coord_polar(theta="y") +
  theme_void() +
  labs(title="Other Visits: Was an non-opioid analgesic prescribed during the visit?",
       subtitle="(NSAIDs, Acetaminophen)") -> plot_pie_nsaid_noncase
plot_pie_nsaid_noncase
```

```{r plot pie rx_nsaid_ace subset ntdc}
df_prop_nsaid_subset_ntdc <- data.frame(
  Category=c("No","Yes"),
  value=c(49,51)
)
ggplot(df_prop_nsaid_subset_ntdc,
       aes(x="",
         y=value,
         fill=Category)) +
  geom_bar(stat="identity",
           width=1) +
  scale_fill_brewer(palette="YlOrRd") +
  coord_polar(theta="y") +
  theme_void() +
  labs(title="Dental Visit: Was an non-opioid analgesic prescribed during the visit?",
       subtitle="(NSAIDs, Acetaminophen)") -> plot_pie_nsaid_ntdc
plot_pie_nsaid_ntdc
```

### rx_antibiotic

```{r plot pie rx_antibiotic noncase}
df_prop_antibiotic_noncase <- data.frame(
  Category=c("No","Yes"),
  value=c(85,15)
)
ggplot(df_prop_antibiotic_noncase,
       aes(x="",
         y=value,
         fill=Category)) +
  geom_bar(stat="identity",
           width=1) +
  scale_fill_brewer(palette="YlOrRd") +
  coord_polar(theta="y") +
  theme_void() +
  labs(title="Other Visits: Was an antibiotic prescribed during the visit?") -> plot_pie_antibiotic_noncase
plot_pie_antibiotic_noncase
```

```{r plot pie rx_antibiotic subset ntdc}
df_prop_antibiotic_subset_ntdc <- data.frame(
  Category=c("No","Yes"),
  value=c(26,74)
)
ggplot(df_prop_antibiotic_subset_ntdc,
       aes(x="",
         y=value,
         fill=Category)) +
  geom_bar(stat="identity",
           width=1) +
  scale_fill_brewer(palette="YlOrRd") +
  coord_polar(theta="y") +
  theme_void() +
  labs(title="Dental Visit: Was an antibiotic prescribed during the visit?") -> plot_pie_antibiotic_ntdc
plot_pie_antibiotic_ntdc
```

# Exploring Age

## Age in MW

```{r}
svychisq(~Age+DentalVisit,survey_design_subset_geo3,statistic="Wald")
svychisq(~Age+DentalVisit,survey_design_subset_geo4,statistic="Wald")
```

```{r plot bar cross age within MW MSA}
df_ref |>
 filter(geo_strata == "MW MSA") |>
ggbarcrosstabs(Age,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Patient Age among Visits within Midwest MSA",
    x="Patient Age Group",
    y="Proportion of Visits"
    ) -> plot_bar_cross_age_geo3
plot_bar_cross_age_geo3
```

```{r plot bar cross age within MW nonMSA}
df_ref |>
 filter(geo_strata == "MW non-MSA") |>
ggbarcrosstabs(Age,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Patient Age among Visits within Midwest Non-MSA",
    x="Patient Age Group",
    y="Proportion of Visits"
    ) -> plot_bar_cross_age_geo4
plot_bar_cross_age_geo4
```

```{r}
model_age_cont <- svyglm(ntdc ~ AGE,
             survey_design_ref,
             subset=NULL,
             family=binomial(),
             start=NULL)
summary(model_age_cont)
exp(-0.009047)
```

```{r}
df_ref |>
  ggplot() +
     aes(x=AGE) +
      geom_histogram() -> plot_hist_age_cont_all
plot_hist_age_cont_all
```

```{r}
df_ref |>
  filter(ntdc==1) |>
  ggplot() +
     aes(x=AGE) +
      geom_histogram() -> plot_hist_age_cont
plot_hist_age_cont
```

## LogReg Age 

### NTDC~Age*Geo

```{r logreg age original levels}
model_age_original <- svyglm(
              ntdc ~ ager_f,
               survey_design_ref,
               subset=NULL,
               family=binomial(),
               start=NULL)
summary(model_age_original)
```

```{r logreg age condensed levels}
model_age_condensed <- svyglm(
              ntdc ~ ager_lvl,
               survey_design_ref,
               subset=NULL,
               family=binomial(),
               start=NULL)
summary(model_age_condensed)
```

```{r logreg age geo interaction}
model_age_geoi <- svyglm(
              ntdc ~ ager_lvl * geo_strata,
               survey_design_ref,
               subset=NULL,
               family=binomial(),
               start=NULL)
summary(model_age_geoi)
```

```{r logistic coefficients model_age_geoi}
model_age_geoi |>
  tidy() |>
  mutate(estimate=round(estimate,5)) |>
  mutate(
    p.value =
      case_when(
        p.value >= 0.001 ~ glue("p = {round(p.value, 3)}"),
        p.value <  0.001 ~ "p < 0.001")
    ) -> model_age_geoi_betas
model_age_geoi_betas
```

```{r or model_age_geoi}
model_age_geoi_betas |>
  filter(term != "(Intercept)") |>
  mutate(odds_ratio=round(exp(estimate),2)) |>
  mutate(lower=round(exp(estimate+qnorm(0.025)*std.error),2)) |>
  mutate(upper=round(exp(estimate+qnorm(0.975)*std.error),2)) |>
  select(term, odds_ratio, lower, upper) -> model_age_geoi_or
model_age_geoi_or
```

```{r logreg age only geo interaction}
model_age_geoi <- svyglm(
              ntdc ~ ager_lvl * geo_strata,
               survey_design_ref,
               subset=NULL,
               family=binomial(),
               start=NULL)
summary(model_age_geoi)
```

```{r}
#write_csv(model_age_geoi_betas,"Betas - Age with Geo Interaction.csv")
#write_csv(model_age_geoi_or,"OR - Age with Geo Interaction.csv")
```

### NTDC~Age*Geo+Covariates

```{r logreg model_age_geoi_covar interaction}
model_age_geoi_covar <- svyglm(
              ntdc ~ ager_lvl * geo_strata + 
                racereth_f + 
                sex_f + 
                paytyper_lvl + 
                residnce_lvl,
               survey_design_ref,
               subset=NULL,
               family=binomial(),
               start=NULL)
summary(model_age_geoi_covar)
```

```{r logistic coefficients model_age_geoi_covar}
model_age_geoi_covar |>
  tidy() |>
  mutate(estimate=round(estimate,5)) |>
  mutate(
    p.value =
      case_when(
        p.value >= 0.001 ~ glue("p = {round(p.value, 3)}"),
        p.value <  0.001 ~ "p < 0.001")
    ) -> model_age_geoi_covar_betas
model_age_geoi_covar_betas
```

```{r or model_age_geoi_covar}
model_age_geoi_covar_betas |>
  filter(term != "(Intercept)") |>
  mutate(odds_ratio=round(exp(estimate),2)) |>
  mutate(lower=round(exp(estimate+qnorm(0.025)*std.error),2)) |>
  mutate(upper=round(exp(estimate+qnorm(0.975)*std.error),2)) |>
  select(term, odds_ratio, lower, upper) -> model_age_geoi_covar_or
model_age_geoi_covar_or
```

```{r}
#write_csv(model_age_geoi_covar_betas,"Betas - Age and Covariates with Geo Interaction.csv")
#write_csv(model_age_geoi_covar_or,"OR - Age and Covariates with Geo Interaction.csv")
```


# Logistic Regression by Region

```{r logreg r0}
r0 <- svyglm(ntdc ~ region_lvl + msa_f,
             survey_design_ref,
             subset=NULL,
             family=binomial(),
             start=NULL)
summary(r0)
```

```{r logreg region interaction}
ri <- svyglm(ntdc ~ 
               ager_lvl + racereth_f + sex_f + paytyper_lvl + residnce_lvl * region_lvl,
             survey_design_ref,
             subset=NULL,
             family=binomial(),
             start=NULL)
summary(ri)
```

## Logistic Regression within MSA

```{r logreg msa0}
msa0 <- svyglm(ntdc ~ Metro,
             survey_design_ref,
             subset=NULL,
             family=binomial(),
             start=NULL)
summary(msa0)
```

```{r logreg msa interaction}
msai <- svyglm(ntdc ~ 
               ager_lvl+
               racereth_f+
               sex_f+
               paytyper_lvl+
               residnce_lvl 
                * Metro,
             survey_design_ref,
             subset=NULL,
             family=binomial(),
             start=NULL)
summary(msai)
```

# LogReg All five Predictors & Geo as Interaction 

```{r logreg geo interaction}
model_geoi <- svyglm(ntdc ~ 
               ager_lvl * geo_strata +
               racereth_f * geo_strata +
               sex_f * geo_strata+
               paytyper_lvl * geo_strata +
               residnce_lvl * geo_strata,
             survey_design_ref,
             subset=NULL,
             family=binomial(),
             start=NULL)
summary(model_geoi)
```

# Stratefied Logistic Regression (by geo_strata)

Formula notes:

- intercept value only [outcome (y) ~ 1]

- logistic regression [outcome (y) ~ predictor (x1) + predictor (x2) + predictor (x3) ]

- interactions [outcome (y) ~ predictor (x1) * predictor (x2) ...]

## G0 No subset

Residence level was stat-sig-associated with presence of an NTDC visit, but because the variable had so few people in among the non-reference levels, it was omitted from the stratified models. 


### m0 intercept only 

```{r logreg intercept only}
m0 <- svyglm(ntdc ~ 1,
             survey_design,
             subset=NULL,
             family=binomial(),
             start=NULL)
summary(m0)
```

### i1 interaction model example

```{r logreg i1}
i1 <- svyglm(ntdc ~ ager_lvl * racereth_f,
             survey_design_ref,
             subset=NULL,
             family=binomial(),
             start=NULL)
summary(i1)
```

### G0 Model

```{r logreg g0 model ref design}
model_g0 <- svyglm(ntdc ~ ager_lvl + RaceEth + Sex + paytyper_lvl + residnce_lvl,
             survey_design_ref,
             subset=NULL,
             family=binomial(),
             start=NULL)
summary(model_g0)
```
#### G0 CHI SQU

```{r g0 model chisq primary}
svychisq(~Age+DentalVisit,survey_design_ref,statistic="Wald")
svychisq(~RaceEth+DentalVisit,survey_design_ref,statistic="Wald")
svychisq(~Sex+DentalVisit,survey_design_ref,statistic="Wald")
svychisq(~ResidenceType+DentalVisit,survey_design_ref,statistic="Wald")
svychisq(~PayerType+DentalVisit,survey_design_ref,statistic="Wald")
```

#### G0 Age model

```{r logreg age}
model_age <- svyglm(ntdc ~ ager_lvl,
             survey_design_ref,
             subset=NULL,
             family=binomial(),
             start=NULL)
summary(model_age)
```

#### G0 age model + region interaction

```{r logreg age region interaction}
model_age_ri <- svyglm(ntdc ~ ager_lvl * region_lvl,
             survey_design_ref,
             subset=NULL,
             family=binomial(),
             start=NULL)
summary(model_age_ri)
```

#### G0 age model + msa interaction

```{r logreg age msa interaction}
model_age_mi <- svyglm(ntdc ~ ager_lvl * msa_f,
             survey_design_ref,
             subset=NULL,
             family=binomial(),
             start=NULL)
summary(model_age_mi)
```

#### G0 age model + geo interaction

```{r logreg age geostrata interaction}
model_age_gi <- svyglm(ntdc ~ ager_lvl * geo_strata,
             survey_design_ref,
             subset=NULL,
             family=binomial(),
             start=NULL)
summary(model_age_gi)
```

#### G0 Age model with covariates

```{r logreg g0}
g0 <- svyglm(ntdc ~ ager_lvl + racereth_f + sex_f + paytyper_lvl + residnce_lvl,
             survey_design_ref,
             subset=NULL,
             family=binomial(),
             start=NULL)
summary(g0)
```

```{r logistic coefficients g0}
g0 |>
  tidy() |>
  mutate(estimate=round(estimate,5)) |>
  mutate(
    p.value =
      case_when(
        p.value >= 0.001 ~ glue("p = {round(p.value, 3)}"),
        p.value <  0.001 ~ "p < 0.001")
    ) -> g0_betas
g0_betas
```

```{r or g0}
g0_betas |>
  filter(term != "(Intercept)") |>
  mutate(odds_ratio=round(exp(estimate),3)) |>
  mutate(lower=round(exp(estimate+qnorm(0.025)*std.error),3)) |>
  mutate(upper=round(exp(estimate+qnorm(0.975)*std.error),3)) |>
  select(term, odds_ratio, lower, upper) -> g0_or
g0_or
```

## G1 (NE MSA) - 15% (NTDC 12%) of Sample

```{r g1 prop noncase}
svyciprop(~I(geo_strata=="NE MSA"),survey_design_subset_noncase,method="lo")
```

```{r g1 prop ntdc}
svyciprop(~I(geo_strata=="NE MSA"),survey_design_subset_ntdc,method="lo")
```

```{r logreg g1}
g1 <- svyglm(ntdc~ager_lvl+racereth_f+sex_f+paytyper_lvl+residnce_lvl,
             survey_design_ref,
             subset=geo_strata=="NE MSA",
             family=binomial(),
             start=NULL)
summary(g1)
```

```{r logistic coefficients g1}
g1 |>
  tidy() |>
  mutate(estimate=round(estimate,5)) |>
  mutate(
    p.value =
      case_when(
        p.value >= 0.001 ~ glue("p = {round(p.value, 3)}"),
        p.value <  0.001 ~ "p < 0.001")
    ) -> g1_betas
g1_betas
```

```{r or g1}
g1_betas |>
  filter(term != "(Intercept)") |>
  mutate(odds_ratio=round(exp(estimate),3)) |>
  mutate(lower=round(exp(estimate+qnorm(0.025)*std.error),3)) |>
  mutate(upper=round(exp(estimate+qnorm(0.975)*std.error),3)) |>
  select(term, odds_ratio, lower, upper) -> g1_or
g1_or
```

### G1 ChiSq

```{r g1 chisq primary}
svychisq(~ager_f+ntdc,survey_design_subset_geo1,statistic="Wald")
svychisq(~sex_f+ntdc,survey_design_subset_geo1,statistic="Wald")
svychisq(~racereth_f+ntdc,survey_design_subset_geo1,statistic="Wald")
svychisq(~residnce_f+ntdc,survey_design_subset_geo1,statistic="Wald")
svychisq(~paytyper_f+ntdc,survey_design_subset_geo1,statistic="Wald")
```

```{r g1 chisq secondary}
svychisq(~diab_status+ntdc,survey_design_subset_geo1,statistic="Wald")
svychisq(~substab_f+ntdc,survey_design_subset_geo1,statistic="Wald")
svychisq(~rx_opioid+ntdc,survey_design_subset_geo1,statistic="Wald")
svychisq(~rx_nsaid_ace+ntdc,survey_design_subset_geo1,statistic="Wald")
svychisq(~rx_antibiotic+ntdc,survey_design_subset_geo1,statistic="Wald")
```

### G1 Model Testing

#### Age

```{r g1 age prop test}
df_select_factored |>
 filter(geo_strata == "NE MSA") |>
ggbarcrosstabs(Age,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Patient Age among Visits within Northeast MSA",
    x="Patient Age Group",
    y="Proportion of Visits"
    ) -> plot_bar_cross_age_g1
plot_bar_cross_age_g1
```

#### Sex

```{r g1 sex prop test}
df_select_factored |>
 filter(geo_strata == "NE MSA") |>
ggbarcrosstabs(sex_f,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Patient Sex among Visits within Northeast MSA",
    x="Patient Sex",
    y="Proportion of Visits"
    ) -> plot_bar_cross_sex_g1
plot_bar_cross_sex_g1
```

#### Race & Ethnicity

```{r g1 racereth prop test}
df_select_factored |>
 filter(geo_strata == "NE MSA") |>
ggbarcrosstabs(RaceEth,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Race & Ethnicity among Visits within Northeast MSA",
    x="Race & Ethnicity Group",
    y="Proportion of Visits"
    ) -> plot_bar_cross_racereth_g1
plot_bar_cross_racereth_g1
```

#### Pay Type

```{r g1 paytyper prop test}
df_select_factored |>
 filter(geo_strata == "NE MSA") |>
ggbarcrosstabs(PayerType,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Payer Type among Visits within Northeast MSA",
    x="Payer Type",
    y="Proportion of Visits"
    ) -> plot_bar_cross_paytyper_g1
plot_bar_cross_paytyper_g1
```

#### Residence

```{r g1 residnce prop test}
df_select_factored |>
 filter(geo_strata == "NE MSA") |>
ggbarcrosstabs(ResidenceType,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Residence Type among Visits within Northeast MSA",
    x="Residence Type",
    y="Proportion of Visits"
    ) -> plot_bar_cross_residnce_g1
plot_bar_cross_residnce_g1
```

#### Diabetic Status

```{r g1 diab_status prop test}
df_select_factored |>
 filter(geo_strata == "NE MSA") |>
ggbarcrosstabs(diab_status,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Diabetic Status among Visits within Northeast MSA",
    x="Diabetic Status",
    y="Proportion of Visits"
    ) -> plot_bar_cross_diab_g1
plot_bar_cross_diab_g1
```

#### Substance Use

```{r g1 substab prop test}
df_select_factored |>
 filter(geo_strata == "NE MSA") |>
ggbarcrosstabs(substab_f,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Patient Substance Use among Visits within Northeast MSA",
    x="History of Substance Use",
    y="Proportion of Visits"
    ) -> plot_bar_cross_substab_g1
plot_bar_cross_substab_g1
```

#### Opioids

```{r g1 rx_opioid prop test}
df_select_factored |>
 filter(geo_strata == "NE MSA") |>
ggbarcrosstabs(rx_opioid,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Opioid Prescribing within Northeast MSA",
    x="Opioid Medication Given During Visit",
    y="Proportion of Visits"
    ) -> plot_bar_cross_opioid_g1
plot_bar_cross_opioid_g1
```

#### NSAID/Acet

```{r g1 rx_nsaid_ace prop test}
df_select_factored |>
 filter(geo_strata == "NE MSA") |>
ggbarcrosstabs(rx_nsaid_ace,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="NSAID/Acetaminophen Prescribing within Northeast MSA",
    x="NSAID and/or Acetaminophen Given During Visit",
    y="Proportion of Visits"
    ) -> plot_bar_cross_nsaid_g1
plot_bar_cross_nsaid_g1
```

#### Antibiotics

```{r g1 rx_antibiotic prop test}
df_select_factored |>
 filter(geo_strata == "NE MSA") |>
ggbarcrosstabs(rx_antibiotic,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Antibiotic Prescribing within Northeast MSA",
    x="Antibiotic Given During Visit",
    y="Proportion of Visits"
    ) -> plot_bar_cross_antibiotic_g1
plot_bar_cross_antibiotic_g1
```

## G2 (NE non-MSA)-BAD MODEL FIT, 1% (NTDC 2%) of Sample

```{r g2 prop noncase}
svyciprop(~I(geo_strata=="NE non-MSA"),survey_design_subset_noncase,method="lo")
```

```{r g2 prop ntdc}
svyciprop(~I(geo_strata=="NE non-MSA"),survey_design_subset_ntdc,method="lo")
```

```{r logreg g2}
g2 <- svyglm(ntdc~ager_lvl+racereth_f+sex_f+paytyper_lvl+residnce_lvl,
             survey_design_ref,
             subset=geo_strata=="NE non-MSA",
             family=binomial(),
             start=NULL)
summary(g2)
```

```{r logistic coefficients g2}
g2 |>
  tidy() |>
  mutate(estimate=round(estimate,5)) |>
  mutate(
    p.value =
      case_when(
        p.value >= 0.001 ~ glue("p = {round(p.value, 3)}"),
        p.value <  0.001 ~ "p < 0.001")
    ) -> g2_betas
g2_betas
```

```{r or g2}
g2_betas |>
  filter(term != "(Intercept)") |>
  mutate(odds_ratio=round(exp(estimate),3)) |>
  mutate(lower=round(exp(estimate+qnorm(0.025)*std.error),3)) |>
  mutate(upper=round(exp(estimate+qnorm(0.975)*std.error),3)) |>
  select(term, odds_ratio, lower, upper) -> g2_or
g2_or
```

\ G2 might have too many variables for this strata to handle in the model.
\ **If proportion <10% may make an unstable model** when there are a large number of covariates.
Add in predictors stepwise to check where it breaks the model.

### G2 ChiSq

AGE, RACERETH, RESIDNCE PAYTYPER DOES NOT RUN

```{r g2 chisq}
svychisq(~sex_f+ntdc,survey_design_subset_geo2,statistic="Wald")
```

```{r g2 chisq secondary}
svychisq(~diab_status+ntdc,survey_design_subset_geo2,statistic="Wald")
svychisq(~substab_f+ntdc,survey_design_subset_geo2,statistic="Wald")
svychisq(~rx_opioid+ntdc,survey_design_subset_geo2,statistic="Wald")
svychisq(~rx_nsaid_ace+ntdc,survey_design_subset_geo2,statistic="Wald")
svychisq(~rx_antibiotic+ntdc,survey_design_subset_geo2,statistic="Wald")
```

```{r}
svyciprop(~I(sex_f=="Female"),survey_design_subset_geo2,method="lo")
svyciprop(~I(sex_f=="Male"),survey_design_subset_geo2,method="lo")
```

```{r}
svyciprop(~I(sex_f=="Female"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(sex_f=="Male"),survey_design_subset_ntdc,method="lo")
```

### G2 Model Testing (2%; CI 0.3%-13%)

```{r g2 prop ntdc test}
svyciprop(~I(geo_strata=="NE non-MSA"),survey_design_subset_ntdc,method="lo")
```

\ Proportion of sample for NE non-MSA is 2% - causing unstable model.

\ Stepwise Addition of Covariates: Each variable *alone* cause a poor model fit or was entirely broken, ie. would not process. Error message noted for broken models. 

#### Age

```{r g2 age prop test}
df_select_factored |>
 filter(geo_strata == "NE non-MSA") |>
ggbarcrosstabs(Age,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Patient Age among Visits within NE non-MSA",
    x="Patient Age Group",
    y="Proportion of Visits"
    ) -> plot_bar_cross_age_g2
plot_bar_cross_age_g2
```

```{r logreg g2t1}
g2_t1 <- svyglm(ntdc~ager_lvl,
             survey_design_ref,
             subset=geo_strata=="NE non-MSA",
             family=binomial(),
             start=NULL)
summary(g2_t1)
```

```{r logistic coefficients g2t1}
g2_t1 |>
  tidy() |>
  mutate(estimate=round(estimate,5)) |>
  mutate(
    p.value =
      case_when(
        p.value >= 0.001 ~ glue("p = {round(p.value, 3)}"),
        p.value <  0.001 ~ "p < 0.001")
    ) -> g2_t1_betas
g2_t1_betas
```

```{r or g2t1}
g2_t1_betas |>
  filter(term != "(Intercept)") |>
  mutate(odds_ratio=round(exp(estimate),3)) |>
  mutate(lower=round(exp(estimate+qnorm(0.025)*std.error),3)) |>
  mutate(upper=round(exp(estimate+qnorm(0.975)*std.error),3)) |>
  select(term, odds_ratio, lower, upper) -> g2_t1_or
g2_t1_or
```

#### Sex

```{r g2 sex prop test}
df_select_factored |>
 filter(geo_strata == "NE non-MSA") |>
ggbarcrosstabs(sex_f,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Patient Sex among Visits within Northeast non-MSA",
    x="Patient Sex",
    y="Proportion of Visits"
    ) -> plot_bar_cross_sex_g2
plot_bar_cross_sex_g2
```

```{r logreg g2t2}
g2_t2 <- svyglm(ntdc~sex_f,
             survey_design_ref,
             subset=geo_strata=="NE non-MSA",
             family=binomial(),
             start=NULL)
summary(g2_t2)
```

```{r logistic coefficients g2t2}
g2_t2 |>
  tidy() |>
  mutate(estimate=round(estimate,5)) |>
  mutate(
    p.value =
      case_when(
        p.value >= 0.001 ~ glue("p = {round(p.value, 3)}"),
        p.value <  0.001 ~ "p < 0.001")
    ) -> g2_t2_betas
g2_t2_betas
```

```{r or g2t2}
g2_t2_betas |>
  filter(term != "(Intercept)") |>
  mutate(odds_ratio=round(exp(estimate),3)) |>
  mutate(lower=round(exp(estimate+qnorm(0.025)*std.error),3)) |>
  mutate(upper=round(exp(estimate+qnorm(0.975)*std.error),3)) |>
  select(term, odds_ratio, lower, upper) -> g2_t2_or
g2_t2_or
```

#### Race & Ethnicity

No non-White among NTDC cases.

\ Error in svyglm.survey.design(ntdc ~ racereth_lvl, survey_design_ref,: all variables must be in design= argument

```{r g2 racereth prop test}
df_select_factored |>
 filter(geo_strata == "NE non-MSA") |>
ggbarcrosstabs(RaceEth,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Race & Ethnicity among Visits within Northeast non-MSA",
    x="Race & Ethnicity Group",
    y="Proportion of Visits"
    ) -> plot_bar_cross_racereth_g2
plot_bar_cross_racereth_g2
```

DOES NOT RUN:
r logreg g2t3
g2_t3 <- svyglm(ntdc~racereth_lvl,
             survey_design_ref,
             subset=geo_strata=="NE non-MSA",
             family=binomial(),
             start=NULL)
summary(g2_t3)

#### Pay Type

```{r g2 paytyper prop test}
df_select_factored |>
 filter(geo_strata == "NE non-MSA") |>
ggbarcrosstabs(PayerType,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Payer Type among Visits within Northeast non-MSA",
    x="Payer Type",
    y="Proportion of Visits"
    ) -> plot_bar_cross_paytyper_g2
plot_bar_cross_paytyper_g2
```

```{r logreg g2t4}
g2_t4 <- svyglm(ntdc~paytyper_lvl,
             survey_design_ref,
             subset=geo_strata=="NE non-MSA",
             family=binomial(),
             start=NULL)
summary(g2_t4)
```

```{r logistic coefficients g2t4}
g2_t4 |>
  tidy() |>
  mutate(estimate=round(estimate,5)) |>
  mutate(
    p.value =
      case_when(
        p.value >= 0.001 ~ glue("p = {round(p.value, 3)}"),
        p.value <  0.001 ~ "p < 0.001")
    ) -> g2_t4_betas
g2_t4_betas
```

```{r or g2t4}
g2_t4_betas |>
  filter(term != "(Intercept)") |>
  mutate(odds_ratio=round(exp(estimate),3)) |>
  mutate(lower=round(exp(estimate+qnorm(0.025)*std.error),3)) |>
  mutate(upper=round(exp(estimate+qnorm(0.975)*std.error),3)) |>
  select(term, odds_ratio, lower, upper) -> g2_t4_or
g2_t4_or
```

#### Residence

```{r g2 residnce prop test}
df_select_factored |>
 filter(geo_strata == "NE non-MSA") |>
ggbarcrosstabs(ResidenceType,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Residence Type among Visits within Northeast non-MSA",
    x="Residence Type",
    y="Proportion of Visits"
    ) -> plot_bar_cross_residnce_g2
plot_bar_cross_residnce_g2
```

```{r logreg g2t5}
g2_t5 <- svyglm(ntdc~residnce_lvl,
             survey_design_ref,
             subset=geo_strata=="NE non-MSA",
             family=binomial(),
             start=NULL)
summary(g2_t5)
```

```{r logistic coefficients g2t5}
g2_t5 |>
  tidy() |>
  mutate(estimate=round(estimate,5)) |>
  mutate(
    p.value =
      case_when(
        p.value >= 0.001 ~ glue("p = {round(p.value, 3)}"),
        p.value <  0.001 ~ "p < 0.001")
    ) -> g2_t5_betas
g2_t5_betas
```

```{r or g2t5}
g2_t5_betas |>
  filter(term != "(Intercept)") |>
  mutate(odds_ratio=round(exp(estimate),3)) |>
  mutate(lower=round(exp(estimate+qnorm(0.025)*std.error),3)) |>
  mutate(upper=round(exp(estimate+qnorm(0.975)*std.error),3)) |>
  select(term, odds_ratio, lower, upper) -> g2_t5_or
g2_t5_or
```

#### Diabetic Status

```{r g2 diab_status prop test}
df_select_factored |>
 filter(geo_strata == "NE non-MSA") |>
ggbarcrosstabs(diab_status,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Diabetic Status among Visits within Northeast non-MSA",
    x="Diabetic Status",
    y="Proportion of Visits"
    ) -> plot_bar_cross_diab_g2
plot_bar_cross_diab_g2
```

#### Substance Use

```{r g2 substab prop test}
df_select_factored |>
 filter(geo_strata == "NE non-MSA") |>
ggbarcrosstabs(substab_f,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Substance Use among Visits within Northeast non-MSA",
    x="History of Substance Use",
    y="Proportion of Visits"
    ) -> plot_bar_cross_substab_g2
plot_bar_cross_substab_g2
```

#### Opioid

```{r g2 rx_opioid prop test}
df_select_factored |>
 filter(geo_strata == "NE non-MSA") |>
ggbarcrosstabs(rx_opioid,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Opioid Prescribing within Northeast non-MSA",
    x="Opioid Medication Given During Visit",
    y="Proportion of Visits"
    ) -> plot_bar_cross_opioid_g2
plot_bar_cross_opioid_g2
```

#### NSAID/Acet

```{r g2 rx_nsaid_ace prop test}
df_select_factored |>
 filter(geo_strata == "NE non-MSA") |>
ggbarcrosstabs(rx_nsaid_ace,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="NSAID/Acetaminophen Prescribing within Northeast non-MSA",
    x="NSAID and/or Acetaminophen Given During Visit",
    y="Proportion of Visits"
    ) -> plot_bar_cross_nsaid_g2
plot_bar_cross_nsaid_g2
```

#### Antibiotic

```{r g2 rx_antibiotic prop test}
df_select_factored |>
 filter(geo_strata == "NE non-MSA") |>
ggbarcrosstabs(rx_antibiotic,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Antibiotic Prescribing within Northeast non-MSA",
    subtitle = "Visit for NTDC?",
    x="Antibiotic Given During Visit",
    y="Proportion of Visits"
    ) -> plot_bar_cross_antibiotic_g2
plot_bar_cross_antibiotic_g2
```

## G3 (MW MSA) - 16% (NTDC 19%) of Sample

```{r g3 prop noncase}
svyciprop(~I(geo_strata=="MW MSA"),survey_design_subset_noncase,method="lo")
```

```{r g3 prop ntdc}
svyciprop(~I(geo_strata=="MW MSA"),survey_design_subset_ntdc,method="lo")
```

```{r logreg g3}
g3 <- svyglm(ntdc~ager_lvl+racereth_f+sex_f+paytyper_lvl+residnce_lvl,
             survey_design_ref,
             subset=geo_strata=="MW MSA",
             family=binomial(),
             start=NULL)
summary(g3)
```

```{r logistic coefficients g3}
g3 |>
  tidy() |>
  mutate(estimate=round(estimate,5)) |>
  mutate(
    p.value =
      case_when(
        p.value >= 0.001 ~ glue("p = {round(p.value, 3)}"),
        p.value <  0.001 ~ "p < 0.001")
    ) -> g3_betas
g3_betas
```

```{r or g3}
g3_betas |>
  filter(term != "(Intercept)") |>
  mutate(odds_ratio=round(exp(estimate),3)) |>
  mutate(lower=round(exp(estimate+qnorm(0.025)*std.error),3)) |>
  mutate(upper=round(exp(estimate+qnorm(0.975)*std.error),3)) |>
  select(term, odds_ratio, lower, upper) -> g3_or
g3_or
```

### G3 ChiSq

```{r g3 chisq primary}
svychisq(~ager_f+ntdc,survey_design_subset_geo3,statistic="Wald")
svychisq(~sex_f+ntdc,survey_design_subset_geo3,statistic="Wald")
svychisq(~racereth_f+ntdc,survey_design_subset_geo3,statistic="Wald")
svychisq(~residnce_f+ntdc,survey_design_subset_geo3,statistic="Wald")
svychisq(~paytyper_f+ntdc,survey_design_subset_geo3,statistic="Wald")
```

```{r g3 chisq secondary}
svychisq(~diab_status+ntdc,survey_design_subset_geo3,statistic="Wald")
svychisq(~substab_f+ntdc,survey_design_subset_geo3,statistic="Wald")
svychisq(~rx_opioid+ntdc,survey_design_subset_geo3,statistic="Wald")
svychisq(~rx_nsaid_ace+ntdc,survey_design_subset_geo3,statistic="Wald")
svychisq(~rx_antibiotic+ntdc,survey_design_subset_geo3,statistic="Wald")
```

### G3 Model Testing

#### Age

```{r g3 age prop test}
df_select_factored |>
 filter(geo_strata == "MW MSA") |>
ggbarcrosstabs(Age,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Patient Age among Visits within Midwest MSA",
    x="Patient Age Group",
    y="Proportion of Visits"
    ) -> plot_bar_cross_age_g3
plot_bar_cross_age_g3
```

#### Sex

```{r g3 sex prop test}
df_select_factored |>
 filter(geo_strata == "MW MSA") |>
ggbarcrosstabs(sex_f,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Patient Sex among Visits within Midwest MSA",
    x="Patient Sex",
    y="Proportion of Visits"
    ) -> plot_bar_cross_sex_g3
plot_bar_cross_sex_g3
```

#### Race & Ethnicity

```{r g3 racereth prop test}
df_select_factored |>
 filter(geo_strata == "MW MSA") |>
ggbarcrosstabs(RaceEth,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Race & Ethnicity among Visits within Midwest MSA",
    x="Race & Ethnicity Group",
    y="Proportion of Visits"
    ) -> plot_bar_cross_racereth_g3
plot_bar_cross_racereth_g3
```

#### Pay Type

```{r g3 paytyper prop test}
df_select_factored |>
 filter(geo_strata == "MW MSA") |>
ggbarcrosstabs(PayerType,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Payer Type among Visits within Midwest MSA",
    x="Payer Type",
    y="Proportion of Visits"
    ) -> plot_bar_cross_paytyper_g3
plot_bar_cross_paytyper_g3
```

#### Residence

```{r g3 residnce prop test}
df_select_factored |>
 filter(geo_strata == "MW MSA") |>
ggbarcrosstabs(ResidenceType,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Residence Type among Visits within Midwest MSA",
    x="Residence Type",
    y="Proportion of Visits"
    ) -> plot_bar_cross_residnce_g3
plot_bar_cross_residnce_g3
```

#### Diabetic Status

```{r g3 diab_status prop test}
df_select_factored |>
 filter(geo_strata == "MW MSA") |>
ggbarcrosstabs(diab_status,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Diabetic Status among Visits within Midwest MSA",
    x="Diabetic Status",
    y="Proportion of Visits"
    ) -> plot_bar_cross_diab_g3
plot_bar_cross_diab_g3
```

#### Substance Use

```{r g3 substab prop test}
df_select_factored |>
 filter(geo_strata == "MW MSA") |>
ggbarcrosstabs(substab_f,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Patient Substance Use among Visits within Midwest MSA",
    x="History of Substance Use",
    y="Proportion of Visits"
    ) -> plot_bar_cross_substab_g3
plot_bar_cross_substab_g3
```

#### Opioids

```{r g3 rx_opioid prop test}
df_ref |>
 filter(geo_strata == "MW MSA") |>
ggbarcrosstabs(rx_opioid,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Opioid Prescribing within Midwest MSA",
    x="Opioid Medication Given During Visit",
    y="Proportion of Visits"
    ) -> plot_bar_cross_opioid_g3
plot_bar_cross_opioid_g3
```


#### NSAID/Acet

```{r g3 rx_nsaid_ace prop test}
df_select_factored |>
 filter(geo_strata == "MW MSA") |>
ggbarcrosstabs(rx_nsaid_ace,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="NSAID/Acetaminophen Prescribing within Midwest MSA",
    x="NSAID and/or Acetaminophen Given During Visit",
    y="Proportion of Visits"
    ) -> plot_bar_cross_nsaid_g3
plot_bar_cross_nsaid_g3
```

#### Antibiotics

```{r g3 rx_antibiotic prop test}
df_ref |>
 filter(geo_strata == "MW MSA") |>
ggbarcrosstabs(rx_antibiotic,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Antibiotic Prescribing within Midwest MSA",
    x="Antibiotic Given During Visit",
    y="Proportion of Visits"
    ) -> plot_bar_cross_antibiotic_g3
plot_bar_cross_antibiotic_g3
```

## G4 (MW non-MSA) - 4% (NTDC 3%) of Sample

```{r g4 prop noncase}
svyciprop(~I(geo_strata=="MW non-MSA"),survey_design_subset_noncase,method="lo")
```

```{r g4 prop ntdc}
svyciprop(~I(geo_strata=="MW non-MSA"),survey_design_subset_ntdc,method="lo")
```

```{r logreg g4}
g4 <- svyglm(ntdc~ager_lvl+racereth_f+sex_f+paytyper_lvl+residnce_lvl,
             survey_design_ref,
             subset=geo_strata=="MW non-MSA",
             family=binomial(),
             start=NULL)
summary(g4)
```

```{r logistic coefficients g4}
g4 |>
  tidy() |>
  mutate(estimate=round(estimate,5)) |>
  mutate(
    p.value =
      case_when(
        p.value >= 0.001 ~ glue("p = {round(p.value, 3)}"),
        p.value <  0.001 ~ "p < 0.001")
    ) -> g4_betas
g4_betas
```

```{r or g4}
g4_betas |>
  filter(term != "(Intercept)") |>
  mutate(odds_ratio=round(exp(estimate),3)) |>
  mutate(lower=round(exp(estimate+qnorm(0.025)*std.error),3)) |>
  mutate(upper=round(exp(estimate+qnorm(0.975)*std.error),3)) |>
  select(term, odds_ratio, lower, upper) -> g4_or
g4_or
```

### G4 ChiSq

```{r g4 chisq primary}
svychisq(~ager_f+ntdc,survey_design_subset_geo4,statistic="Wald")
svychisq(~sex_f+ntdc,survey_design_subset_geo4,statistic="Wald")
svychisq(~racereth_f+ntdc,survey_design_subset_geo4,statistic="Wald")
svychisq(~residnce_f+ntdc,survey_design_subset_geo4,statistic="Wald")
svychisq(~paytyper_f+ntdc,survey_design_subset_geo4,statistic="Wald")
```

```{r g4 chisq secondary}
svychisq(~diab_status+ntdc,survey_design_subset_geo4,statistic="Wald")
svychisq(~substab_f+ntdc,survey_design_subset_geo4,statistic="Wald")
svychisq(~rx_opioid+ntdc,survey_design_subset_geo4,statistic="Wald")
svychisq(~rx_nsaid_ace+ntdc,survey_design_subset_geo4,statistic="Wald")
svychisq(~rx_antibiotic+ntdc,survey_design_subset_geo4,statistic="Wald")
```

### G4 Model Testing

#### Age

```{r g4 age prop test}
df_select_factored |>
 filter(geo_strata == "MW non-MSA") |>
ggbarcrosstabs(Age,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Patient Age among Visits within Midwest non-MSA",
    x="Patient Age Group",
    y="Proportion of Visits"
    ) -> plot_bar_cross_age_g4
plot_bar_cross_age_g4
```

#### Sex

```{r g4 sex prop test}
df_select_factored |>
 filter(geo_strata == "MW non-MSA") |>
ggbarcrosstabs(sex_f,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Patient Sex among Visits within Midwest non-MSA",
    x="Patient Sex",
    y="Proportion of Visits"
    ) -> plot_bar_cross_sex_g4
plot_bar_cross_sex_g4
```

#### Race & Ethnicity

```{r g4 racereth prop test}
df_select_factored |>
 filter(geo_strata == "MW non-MSA") |>
ggbarcrosstabs(RaceEth,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Race & Ethnicity among Visits within Midwest non-MSA",
    x="Race & Ethnicity Group",
    y="Proportion of Visits"
    ) -> plot_bar_cross_racereth_g4
plot_bar_cross_racereth_g4
```

#### Pay Type

```{r g4 paytyper prop test}
df_select_factored |>
 filter(geo_strata == "MW non-MSA") |>
ggbarcrosstabs(PayerType,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Payer Type among Visits within Midwest non-MSA",
    x="Payer Type",
    y="Proportion of Visits"
    ) -> plot_bar_cross_paytyper_g4
plot_bar_cross_paytyper_g4
```

#### Residence

```{r g4 residnce prop test}
df_select_factored |>
 filter(geo_strata == "MW non-MSA") |>
ggbarcrosstabs(ResidenceType,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Residence Type among Visits within Midwest non-MSA",
    x="Residence Type",
    y="Proportion of Visits"
    ) -> plot_bar_cross_residnce_g4
plot_bar_cross_residnce_g4
```

#### Diabetic Status

```{r g4 diab_status prop test}
df_select_factored |>
 filter(geo_strata == "MW non-MSA") |>
ggbarcrosstabs(diab_status,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Diabetic Status among Visits within Midwest non-MSA",
    x="Diabetic Status",
    y="Proportion of Visits"
    ) -> plot_bar_cross_diab_g4
plot_bar_cross_diab_g4
```

#### Substance Use

```{r g4 substab prop test}
df_select_factored |>
 filter(geo_strata == "MW non-MSA") |>
ggbarcrosstabs(substab_f,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Patient Substance Use among Visits within Midwest non-MSA",
    x="History of Substance Use",
    y="Proportion of Visits"
    ) -> plot_bar_cross_substab_g4
plot_bar_cross_substab_g4
```

#### Opioids

```{r g4 rx_opioid prop test}
df_select_factored |>
 filter(geo_strata == "MW non-MSA") |>
ggbarcrosstabs(rx_opioid,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Opioid Prescribing within Midwest non-MSA",
    x="Opioid Medication Given During Visit",
    y="Proportion of Visits"
    ) -> plot_bar_cross_opioid_g4
plot_bar_cross_opioid_g4
```

#### NSAID/Acet

```{r g4 rx_nsaid_ace prop test}
df_select_factored |>
 filter(geo_strata == "MW non-MSA") |>
ggbarcrosstabs(rx_nsaid_ace,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="NSAID/Acetaminophen Prescribing within Midwest non-MSA",
    x="NSAID and/or Acetaminophen Given During Visit",
    y="Proportion of Visits"
    ) -> plot_bar_cross_nsaid_g4
plot_bar_cross_nsaid_g4
```

#### Antibiotics

```{r g4 rx_antibiotic prop test}
df_ref |>
 filter(geo_strata == "MW non-MSA") |>
ggbarcrosstabs(rx_antibiotic,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Antibiotic Prescribing within Midwest non-MSA",
    x="Antibiotic Given During Visit",
    y="Proportion of Visits"
    ) -> plot_bar_cross_antibiotic_g4
plot_bar_cross_antibiotic_g4
```

## G5 (S MSA) - 33% (NTDC 35%) of Sample

```{r g5 prop noncase}
svyciprop(~I(geo_strata=="S MSA"),survey_design_subset_noncase,method="lo")
```

```{r g5 prop ntdc}
svyciprop(~I(geo_strata=="S MSA"),survey_design_subset_ntdc,method="lo")
```

```{r logreg g5}
g5 <- svyglm(ntdc~ager_lvl+racereth_f+sex_f+paytyper_lvl+residnce_lvl,
             survey_design_ref,
             subset=geo_strata=="S MSA",
             family=binomial(),
             start=NULL)
summary(g5)
```

```{r logistic coefficients g5}
g5 |>
  tidy() |>
  mutate(estimate=round(estimate,5)) |>
  mutate(
    p.value =
      case_when(
        p.value >= 0.001 ~ glue("p = {round(p.value, 3)}"),
        p.value <  0.001 ~ "p < 0.001")
    ) -> g5_betas
g5_betas
```

```{r or g5}
g5_betas |>
  filter(term != "(Intercept)") |>
  mutate(odds_ratio=round(exp(estimate),3)) |>
  mutate(lower=round(exp(estimate+qnorm(0.025)*std.error),3)) |>
  mutate(upper=round(exp(estimate+qnorm(0.975)*std.error),3)) |>
  select(term, odds_ratio, lower, upper) -> g5_or
g5_or
```

### G5 ChiSq

```{r g5 chisq primary}
svychisq(~ager_f+ntdc,survey_design_subset_geo5,statistic="Wald")
svychisq(~sex_f+ntdc,survey_design_subset_geo5,statistic="Wald")
svychisq(~racereth_f+ntdc,survey_design_subset_geo5,statistic="Wald")
svychisq(~residnce_f+ntdc,survey_design_subset_geo5,statistic="Wald")
svychisq(~paytyper_f+ntdc,survey_design_subset_geo5,statistic="Wald")
```

```{r g5 chisq secondary}
svychisq(~diab_status+ntdc,survey_design_subset_geo5,statistic="Wald")
svychisq(~substab_f+ntdc,survey_design_subset_geo5,statistic="Wald")
svychisq(~rx_opioid+ntdc,survey_design_subset_geo5,statistic="Wald")
svychisq(~rx_nsaid_ace+ntdc,survey_design_subset_geo5,statistic="Wald")
svychisq(~rx_antibiotic+ntdc,survey_design_subset_geo5,statistic="Wald")
```

### G5 Model Testing

#### Age

```{r g5 age prop test}
df_select_factored |>
 filter(geo_strata == "S MSA") |>
ggbarcrosstabs(Age,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Patient Age among Visits within South MSA",
    x="Patient Age Group",
    y="Proportion of Visits"
    ) -> plot_bar_cross_age_g5
plot_bar_cross_age_g5
```

#### Sex

```{r g5 sex prop test}
df_select_factored |>
 filter(geo_strata == "S MSA") |>
ggbarcrosstabs(sex_f,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Patient Sex among Visits within South MSA",
    x="Patient Sex",
    y="Proportion of Visits"
    ) -> plot_bar_cross_sex_g5
plot_bar_cross_sex_g5
```

#### Race & Ethnicity

```{r g5 racereth prop test}
df_select_factored |>
 filter(geo_strata == "S MSA") |>
ggbarcrosstabs(RaceEth,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Race & Ethnicity among Visits within South MSA",
    x="Race & Ethnicity Group",
    y="Proportion of Visits"
    ) -> plot_bar_cross_racereth_g5
plot_bar_cross_racereth_g5
```

#### Pay Type

```{r g5 paytyper prop test}
df_select_factored |>
 filter(geo_strata == "S MSA") |>
ggbarcrosstabs(PayerType,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Payer Type among Visits within South MSA",
    x="Payer Type",
    y="Proportion of Visits"
    ) -> plot_bar_cross_paytyper_g5
plot_bar_cross_paytyper_g5
```

#### Residence

```{r g5 residnce prop test}
df_select_factored |>
 filter(geo_strata == "S MSA") |>
ggbarcrosstabs(ResidenceType,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Residence Type among Visits within South MSA",
    x="Residence Type",
    y="Proportion of Visits"
    ) -> plot_bar_cross_residnce_g5
plot_bar_cross_residnce_g5
```

#### Diabetic Status

```{r g5 diab_status prop test}
df_select_factored |>
 filter(geo_strata == "S MSA") |>
ggbarcrosstabs(diab_status,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Diabetic Status among Visits within South MSA",
    x="Diabetic Status",
    y="Proportion of Visits"
    ) -> plot_bar_cross_diab_g5
plot_bar_cross_diab_g5
```

#### Substance Use

```{r g5 substab prop test}
df_select_factored |>
 filter(geo_strata == "S MSA") |>
ggbarcrosstabs(substab_f,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Patient Substance Use among Visits within South MSA",
    x="History of Substance Use",
    y="Proportion of Visits"
    ) -> plot_bar_cross_substab_g5
plot_bar_cross_substab_g5
```

#### Opioids

```{r g5 rx_opioid prop test}
df_select_factored |>
 filter(geo_strata == "S MSA") |>
ggbarcrosstabs(rx_opioid,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Opioid Prescribing within South MSA",
    x="Opioid Medication Given During Visit",
    y="Proportion of Visits"
    ) -> plot_bar_cross_opioid_g5
plot_bar_cross_opioid_g5
```

#### NSAID/Acet

```{r g5 rx_nsaid_ace prop test}
df_select_factored |>
 filter(geo_strata == "S MSA") |>
ggbarcrosstabs(rx_nsaid_ace,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="NSAID/Acetaminophen Prescribing within South MSA",
    x="NSAID and/or Acetaminophen Given During Visit",
    y="Proportion of Visits"
    ) -> plot_bar_cross_nsaid_g5
plot_bar_cross_nsaid_g5
```

#### Antibiotics

```{r g5 rx_antibiotic prop test}
df_select_factored |>
 filter(geo_strata == "S MSA") |>
ggbarcrosstabs(rx_antibiotic,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Antibiotic Prescribing within South MSA",
    x="Antibiotic Given During Visit",
    y="Proportion of Visits"
    ) -> plot_bar_cross_antibiotic_g5
plot_bar_cross_antibiotic_g5
```


## G6 (S non-MSA) - 7% (NTDC 7%) of Sample

```{r g6 prop noncase}
svyciprop(~I(geo_strata=="S non-MSA"),survey_design_subset_noncase,method="lo")
```

```{r g6 prop ntdc}
svyciprop(~I(geo_strata=="S non-MSA"),survey_design_subset_ntdc,method="lo")
```

```{r logreg g6}
g6 <- svyglm(ntdc~ager_lvl+racereth_f+sex_f+paytyper_lvl+residnce_lvl,
             survey_design_ref,
             subset=geo_strata=="S non-MSA",
             family=binomial(),
             start=NULL)
summary(g6)
```

```{r logistic coefficients g6}
g6 |>
  tidy() |>
  mutate(estimate=round(estimate,5)) |>
  mutate(
    p.value =
      case_when(
        p.value >= 0.001 ~ glue("p = {round(p.value, 3)}"),
        p.value <  0.001 ~ "p < 0.001")
    ) -> g6_betas
g6_betas
```

```{r or g6}
g6_betas |>
  filter(term != "(Intercept)") |>
  mutate(odds_ratio=round(exp(estimate),3)) |>
  mutate(lower=round(exp(estimate+qnorm(0.025)*std.error),3)) |>
  mutate(upper=round(exp(estimate+qnorm(0.975)*std.error),3)) |>
  select(term, odds_ratio, lower, upper) -> g6_or
g6_or
```

### G6 ChiSq

```{r g6 chisq primary}
svychisq(~ager_f+ntdc,survey_design_subset_geo6,statistic="Wald")
svychisq(~sex_f+ntdc,survey_design_subset_geo6,statistic="Wald")
svychisq(~racereth_f+ntdc,survey_design_subset_geo6,statistic="Wald")
svychisq(~residnce_f+ntdc,survey_design_subset_geo6,statistic="Wald")
svychisq(~paytyper_f+ntdc,survey_design_subset_geo6,statistic="Wald")
```

```{r g6 chisq secondary}
svychisq(~diab_status+ntdc,survey_design_subset_geo6,statistic="Wald")
svychisq(~substab_f+ntdc,survey_design_subset_geo6,statistic="Wald")
svychisq(~rx_opioid+ntdc,survey_design_subset_geo6,statistic="Wald")
svychisq(~rx_nsaid_ace+ntdc,survey_design_subset_geo6,statistic="Wald")
svychisq(~rx_antibiotic+ntdc,survey_design_subset_geo6,statistic="Wald")
```

### G6 Model Testing

#### Age

```{r g6 age prop test}
df_ref |>
 filter(geo_strata == "S non-MSA") |>
ggbarcrosstabs(Age,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Patient Age among Visits within South non-MSA",
    x="Patient Age Group",
    y="Proportion of Visits"
    ) -> plot_bar_cross_age_g6
plot_bar_cross_age_g6
```

#### Sex

```{r g6 sex prop test}
df_select_factored |>
 filter(geo_strata == "S non-MSA") |>
ggbarcrosstabs(sex_f,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Patient Sex among Visits within South non-MSA",
    subtitle = "p = 0.78",
    x="Patient Sex",
    y="Proportion of Visits"
    ) -> plot_bar_cross_sex_g6
plot_bar_cross_sex_g6
```

#### Race & Ethnicity

```{r g6 racereth prop test}
df_select_factored |>
 filter(geo_strata == "S non-MSA") |>
ggbarcrosstabs(RaceEth,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Race & Ethnicity among Visits within South non-MSA",
    subtitle= "p = 0.23",
    x="Race & Ethnicity Group",
    y="Proportion of Visits"
    ) -> plot_bar_cross_racereth_g6
plot_bar_cross_racereth_g6
```

#### Pay Type

```{r g6 paytyper prop test}
df_select_factored |>
 filter(geo_strata == "S non-MSA") |>
ggbarcrosstabs(PayerType,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Payer Type among Visits within South non-MSA",
    subtitle="p = 0.24",
    x="Payer Type",
    y="Proportion of Visits"
    ) -> plot_bar_cross_paytyper_g6
plot_bar_cross_paytyper_g6
```

#### Residence

```{r g6 residnce prop test}
df_select_factored |>
 filter(geo_strata == "S non-MSA") |>
ggbarcrosstabs(ResidenceType,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Residence Type among Visits within South non-MSA",
    subtitle="p = 0.14",
    x="Residence Type",
    y="Proportion of Visits"
    ) -> plot_bar_cross_residnce_g6
plot_bar_cross_residnce_g6
```

#### Diabetic Status

```{r g6 diab_status prop test}
df_select_factored |>
 filter(geo_strata == "S non-MSA") |>
ggbarcrosstabs(diab_status,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Diabetic Status among Visits within South non-MSA",
    x="Diabetic Status",
    y="Proportion of Visits"
    ) -> plot_bar_cross_diab_g6
plot_bar_cross_diab_g6
```

#### Substance Use

```{r g6 substab prop test}
df_select_factored |>
 filter(geo_strata == "S non-MSA") |>
ggbarcrosstabs(substab_f,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Patient Substance Use among Visits within South non-MSA",
    x="History of Substance Use",
    y="Proportion of Visits"
    ) -> plot_bar_cross_substab_g6
plot_bar_cross_substab_g6
```

#### Opioids

```{r g6 rx_opioid prop test}
df_select_factored |>
 filter(geo_strata == "S non-MSA") |>
ggbarcrosstabs(rx_opioid,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Opioid Prescribing within South non-MSA",
    x="Opioid Medication Given During Visit",
    y="Proportion of Visits"
    ) -> plot_bar_cross_opioid_g6
plot_bar_cross_opioid_g6
```

#### NSAID/Acet

```{r g6 rx_nsaid_ace prop test}
df_select_factored |>
 filter(geo_strata == "S non-MSA") |>
ggbarcrosstabs(rx_nsaid_ace,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="NSAID/Acetaminophen Prescribing within South non-MSA",
    x="NSAID and/or Acetaminophen Given During Visit",
    y="Proportion of Visits"
    ) -> plot_bar_cross_nsaid_g6
plot_bar_cross_nsaid_g6
```

#### Antibiotics

```{r g6 rx_antibiotic prop test}
df_select_factored |>
 filter(geo_strata == "S non-MSA") |>
ggbarcrosstabs(rx_antibiotic,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Antibiotic Prescribing within South non-MSA",
    x="Antibiotic Given During Visit",
    y="Proportion of Visits"
    ) -> plot_bar_cross_antibiotic_g6
plot_bar_cross_antibiotic_g6
```

## G7 (W MSA) - 22% (NTDC 20%) of Sample

```{r g7 prop noncase}
svyciprop(~I(geo_strata=="W MSA"),survey_design_subset_noncase,method="lo")
```

```{r g7 prop ntdc}
svyciprop(~I(geo_strata=="W MSA"),survey_design_subset_ntdc,method="lo")
```

```{r logreg g7}
g7 <- svyglm(ntdc~ager_lvl+racereth_f+sex_f+paytyper_lvl+residnce_lvl,
             survey_design_ref,
             subset=geo_strata=="W MSA",
             family=binomial(),
             start=NULL)
summary(g7)
```

```{r logistic coefficients g7}
g7 |>
  tidy() |>
  mutate(estimate=round(estimate,5)) |>
  mutate(
    p.value =
      case_when(
        p.value >= 0.001 ~ glue("p = {round(p.value, 3)}"),
        p.value <  0.001 ~ "p < 0.001")
    ) -> g7_betas
g7_betas
```

```{r or g7}
g7_betas |>
  filter(term != "(Intercept)") |>
  mutate(odds_ratio=round(exp(estimate),3)) |>
  mutate(lower=round(exp(estimate+qnorm(0.025)*std.error),3)) |>
  mutate(upper=round(exp(estimate+qnorm(0.975)*std.error),3)) |>
  select(term, odds_ratio, lower, upper) -> g7_or
g7_or
```

### G7 ChiSq

```{r g7 chisq primary}
svychisq(~ager_f+ntdc,survey_design_subset_geo7,statistic="Wald")
svychisq(~sex_f+ntdc,survey_design_subset_geo7,statistic="Wald")
svychisq(~racereth_f+ntdc,survey_design_subset_geo7,statistic="Wald")
svychisq(~residnce_f+ntdc,survey_design_subset_geo7,statistic="Wald")
svychisq(~paytyper_f+ntdc,survey_design_subset_geo7,statistic="Wald")
```

```{r g7 chisq secondary}
svychisq(~diab_status+ntdc,survey_design_subset_geo7,statistic="Wald")
svychisq(~substab_f+ntdc,survey_design_subset_geo7,statistic="Wald")
svychisq(~rx_opioid+ntdc,survey_design_subset_geo7,statistic="Wald")
svychisq(~rx_nsaid_ace+ntdc,survey_design_subset_geo7,statistic="Wald")
svychisq(~rx_antibiotic+ntdc,survey_design_subset_geo7,statistic="Wald")
```

### G7 Model Testing (20%; CI 14%-28%)

```{r g7 prop ntdc test}
svyciprop(~I(geo_strata=="W MSA"),survey_design_subset_ntdc,method="lo")
```

\ Proportion of sample for W MSA is 20%.

#### Age

```{r g7 age prop test}
df_select_factored |>
 filter(geo_strata == "W MSA") |>
ggbarcrosstabs(Age,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Patient Age among Visits within West MSA",
    subtitle="p < 0.001",
    x="Patient Age Group",
    y="Proportion of Visits"
    ) -> plot_bar_cross_age_g7
plot_bar_cross_age_g7
```

#### Sex

```{r g7 sex prop test}
df_select_factored |>
 filter(geo_strata == "W MSA") |>
ggbarcrosstabs(sex_f,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Patient Sex among Visits within West MSA",
    subtitle = "p = 0.7",
    x="Patient Sex",
    y="Proportion of Visits"
    ) -> plot_bar_cross_sex_g7
plot_bar_cross_sex_g7
```

#### Race & Ethnicity

```{r g7 racereth prop test}
df_select_factored |>
 filter(geo_strata == "W MSA") |>
ggbarcrosstabs(RaceEth,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Race & Ethnicity among Visits within West MSA",
    subtitle = "p = 0.002",
    x="Race & Ethnicity Group",
    y="Proportion of Visits"
    ) -> plot_bar_cross_racereth_g7
plot_bar_cross_racereth_g7
```

#### Pay Type

```{r g7 paytyper prop test}
df_select_factored |>
 filter(geo_strata == "W MSA") |>
ggbarcrosstabs(PayerType,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Payer Type among Visits within West MSA",
    subtitle = "p < 0.001",
    x="Payer Type",
    y="Proportion of Visits"
    ) -> plot_bar_cross_paytyper_g7
plot_bar_cross_paytyper_g7
```

#### Residence

```{r g7 residnce prop test}
df_select_factored |>
 filter(geo_strata == "W MSA") |>
ggbarcrosstabs(ResidenceType,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Residence Type among Visits within West MSA",
    subtitle = "p < 0.001 ",
    x="Residence Type",
    y="Proportion of Visits"
    ) -> plot_bar_cross_residnce_g7
plot_bar_cross_residnce_g7
```

#### Diabetic Status

```{r g7 diab_status prop test}
df_select_factored |>
 filter(geo_strata == "W MSA") |>
ggbarcrosstabs(diab_status,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Diabetic Status among Visits within West MSA",
    x="Diabetic Status",
    y="Proportion of Visits"
    ) -> plot_bar_cross_diab_g7
plot_bar_cross_diab_g7
```

#### Substance Use

```{r g7 substab prop test}
df_select_factored |>
 filter(geo_strata == "W MSA") |>
ggbarcrosstabs(substab_f,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Patient Substance Use among Visits within West MSA",
    x="History of Substance Use",
    y="Proportion of Visits"
    ) -> plot_bar_cross_substab_g7
plot_bar_cross_substab_g7
```

#### Opioids

```{r g7 rx_opioid prop test}
df_select_factored |>
 filter(geo_strata == "W MSA") |>
ggbarcrosstabs(rx_opioid,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Opioid Prescribing within West MSA",
    x="Opioid Medication Given During Visit",
    y="Proportion of Visits"
    ) -> plot_bar_cross_opioid_g7
plot_bar_cross_opioid_g7
```

#### NSAID/Acet

```{r g7 rx_nsaid_ace prop test}
df_select_factored |>
 filter(geo_strata == "W MSA") |>
ggbarcrosstabs(rx_nsaid_ace,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="NSAID/Acetaminophen Prescribing within West MSA",
    x="NSAID and/or Acetaminophen Given During Visit",
    y="Proportion of Visits"
    ) -> plot_bar_cross_nsaid_g7
plot_bar_cross_nsaid_g7
```

#### Antibiotics

```{r g7 rx_antibiotic prop test}
df_select_factored |>
 filter(geo_strata == "W MSA") |>
ggbarcrosstabs(rx_antibiotic,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Antibiotic Prescribing within West MSA",
    x="Antibiotic Given During Visit",
    y="Proportion of Visits"
    ) -> plot_bar_cross_antibiotic_g7
plot_bar_cross_antibiotic_g7
```

## G8(W non-MSA)-BAD MODEL FIT- 0.8% (NTDC 1%) of Sample

```{r g8 prop noncase}
svyciprop(~I(geo_strata=="W non-MSA"),survey_design_subset_noncase,method="lo")
```

```{r g8 prop ntdc}
svyciprop(~I(geo_strata=="W non-MSA"),survey_design_subset_ntdc,method="lo")
```

```{r logreg g8}
g8 <- svyglm(ntdc~ager_lvl+racereth_f+sex_f+paytyper_lvl+residnce_lvl,
             survey_design_ref,
             subset=geo_strata=="W non-MSA",
             family=binomial(),
             start=NULL)
summary(g8)
```

```{r logistic coefficients g8}
g8 |>
  tidy() |>
  mutate(estimate=round(estimate,5)) |>
  mutate(
    p.value =
      case_when(
        p.value >= 0.001 ~ glue("p = {round(p.value, 3)}"),
        p.value <  0.001 ~ "p < 0.001")
    ) -> g8_betas
g8_betas
```

```{r or g8}
g8_betas |>
  filter(term != "(Intercept)") |>
  mutate(odds_ratio=round(exp(estimate),3)) |>
  mutate(lower=round(exp(estimate+qnorm(0.025)*std.error),3)) |>
  mutate(upper=round(exp(estimate+qnorm(0.975)*std.error),3)) |>
  select(term, odds_ratio, lower, upper) -> g8_or
g8_or
```

G8 might have too many variables for this strata to handle in the model.
If proportion <10% may make an unstable model when there are a large number of covariates.
Add in predictors stepwise to check where it breaks the model.

### G8 ChiSq

AGE, RACERETH, RESIDNCE, PAYTYPER WOULD NOT RUN

```{r g8 chisq}
svychisq(~sex_f+ntdc,survey_design_subset_geo8,statistic="Wald")
```

```{r}
svyciprop(~I(sex_f=="Female"),survey_design_subset_geo8,method="lo")
svyciprop(~I(sex_f=="Male"),survey_design_subset_geo8,method="lo")
```

```{r}
svyciprop(~I(sex_f=="Female"),survey_design_subset_ntdc,method="lo")
svyciprop(~I(sex_f=="Male"),survey_design_subset_ntdc,method="lo")
```

### G8 Model Testing (1.2%; CI 0.2%-8%)

```{r g2 test prop ntdc}
svyciprop(~I(geo_strata=="W non-MSA"),survey_design_subset_ntdc,method="lo")
```

\ Proportion of sample for W non-MSA is 1% - causing unstable model.

\ Stepwise Addition of Covariates: Each variable *alone* cause a poor model fit or was entirely broken, ie. would not process. Error message noted for broken models. 

\ Age only

```{r logreg g8t1}
g8_t1 <- svyglm(ntdc~ager_lvl,
             survey_design_ref,
             subset=geo_strata=="W non-MSA",
             family=binomial(),
             start=NULL)
summary(g8_t1)
```

```{r logistic coefficients g8t1}
g8_t1 |>
  tidy() |>
  mutate(estimate=round(estimate,5)) |>
  mutate(
    p.value =
      case_when(
        p.value >= 0.001 ~ glue("p = {round(p.value, 3)}"),
        p.value <  0.001 ~ "p < 0.001")
    ) -> g8_t1_betas
g8_t1_betas
```

```{r or g8t1}
g8_t1_betas |>
  filter(term != "(Intercept)") |>
  mutate(odds_ratio=round(exp(estimate),3)) |>
  mutate(lower=round(exp(estimate+qnorm(0.025)*std.error),3)) |>
  mutate(upper=round(exp(estimate+qnorm(0.975)*std.error),3)) |>
  select(term, odds_ratio, lower, upper) -> g8_t1_or
g8_t1_or
```

\ Sex only

```{r logreg g8t2}
g8_t2 <- svyglm(ntdc~sex_f,
             survey_design_ref,
             subset=geo_strata=="W non-MSA",
             family=binomial(),
             start=NULL)
summary(g8_t2)
```

```{r logistic coefficients g8t2}
g8_t2 |>
  tidy() |>
  mutate(estimate=round(estimate,5)) |>
  mutate(
    p.value =
      case_when(
        p.value >= 0.001 ~ glue("p = {round(p.value, 3)}"),
        p.value <  0.001 ~ "p < 0.001")
    ) -> g8_t2_betas
g8_t2_betas
```

```{r or g8t2}
g8_t2_betas |>
  filter(term != "(Intercept)") |>
  mutate(odds_ratio=round(exp(estimate),3)) |>
  mutate(lower=round(exp(estimate+qnorm(0.025)*std.error),3)) |>
  mutate(upper=round(exp(estimate+qnorm(0.975)*std.error),3)) |>
  select(term, odds_ratio, lower, upper) -> g8_t2_or
g8_t2_or
```

\ Race & Ethnicity only

r logreg g8t3
g8_t3 <- svyglm(ntdc~racereth_lvl,
             survey_design_ref,
             subset=geo_strata=="W non-MSA",
             family=binomial(),
             start=NULL)
summary(g8_t3)

Error in svyglm.survey.design(ntdc ~ racereth_lvl, survey_design_ref,  : 
  all variables must be in design= argument

\ Pay Type only

```{r logreg g8t4}
g8_t4 <- svyglm(ntdc~paytyper_lvl,
             survey_design_ref,
             subset=geo_strata=="W non-MSA",
             family=binomial(),
             start=NULL)
summary(g8_t4)
```

```{r logistic coefficients g8t4}
g8_t4 |>
  tidy() |>
  mutate(estimate=round(estimate,5)) |>
  mutate(
    p.value =
      case_when(
        p.value >= 0.001 ~ glue("p = {round(p.value, 3)}"),
        p.value <  0.001 ~ "p < 0.001")
    ) -> g8_t4_betas
g8_t4_betas
```

```{r or g8t4}
g8_t4_betas |>
  filter(term != "(Intercept)") |>
  mutate(odds_ratio=round(exp(estimate),3)) |>
  mutate(lower=round(exp(estimate+qnorm(0.025)*std.error),3)) |>
  mutate(upper=round(exp(estimate+qnorm(0.975)*std.error),3)) |>
  select(term, odds_ratio, lower, upper) -> g8_t4_or
g8_t4_or
```

\ Residence only

```{r logreg g8t5}
g8_t5 <- svyglm(ntdc~residnce_lvl,
             survey_design_ref,
             subset=geo_strata=="W non-MSA",
             family=binomial(),
             start=NULL)
summary(g8_t5)
```

```{r logistic coefficients g8t5}
g8_t5 |>
  tidy() |>
  mutate(estimate=round(estimate,5)) |>
  mutate(
    p.value =
      case_when(
        p.value >= 0.001 ~ glue("p = {round(p.value, 3)}"),
        p.value <  0.001 ~ "p < 0.001")
    ) -> g8_t5_betas
g8_t5_betas
```

```{r or g8t5}
g8_t5_betas |>
  filter(term != "(Intercept)") |>
  mutate(odds_ratio=round(exp(estimate),3)) |>
  mutate(lower=round(exp(estimate+qnorm(0.025)*std.error),3)) |>
  mutate(upper=round(exp(estimate+qnorm(0.975)*std.error),3)) |>
  select(term, odds_ratio, lower, upper) -> g8_t5_or
g8_t5_or
```

#### Age

```{r g8 age prop test}
df_select_factored |>
 filter(geo_strata == "W non-MSA") |>
ggbarcrosstabs(Age,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Patient Age among Visits within West non-MSA",
    x="Patient Age Group",
    y="Proportion of Visits"
    ) -> plot_bar_cross_age_g8
plot_bar_cross_age_g8
```

#### Sex

```{r g8 sex prop test}
df_select_factored |>
 filter(geo_strata == "W non-MSA") |>
ggbarcrosstabs(sex_f,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Patient Sex among Visits within West non-MSA",
    x="Patient Sex",
    y="Proportion of Visits"
    ) -> plot_bar_cross_sex_g8
plot_bar_cross_sex_g8
```

#### Race & Ethnicity

```{r g8 racereth prop test}
df_select_factored |>
 filter(geo_strata == "W non-MSA") |>
ggbarcrosstabs(RaceEth,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Race & Ethnicity among Visits within West non-MSA",
    x="Race & Ethnicity Group",
    y="Proportion of Visits"
    ) -> plot_bar_cross_racereth_g8
plot_bar_cross_racereth_g8
```

#### Pay Type

```{r g8 paytyper prop test}
df_select_factored |>
 filter(geo_strata == "W non-MSA") |>
ggbarcrosstabs(PayerType,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Payer Type among Visits within West non-MSA",
    x="Payer Type",
    y="Proportion of Visits"
    ) -> plot_bar_cross_paytyper_g8
plot_bar_cross_paytyper_g8
```

#### Residence

```{r g8 residnce prop test}
df_select_factored |>
 filter(geo_strata == "W non-MSA") |>
ggbarcrosstabs(ResidenceType,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Residence Type among Visits within West non-MSA",
    x="Residence Type",
    y="Proportion of Visits"
    ) -> plot_bar_cross_residnce_g8
plot_bar_cross_residnce_g8
```

#### Diabetic Status

```{r g8 diab_status prop test}
df_select_factored |>
 filter(geo_strata == "W non-MSA") |>
ggbarcrosstabs(diab_status,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Diabetic Status among Visits within West non-MSA",
    x="Diabetic Status",
    y="Proportion of Visits"
    ) -> plot_bar_cross_diab_g8
plot_bar_cross_diab_g8
```

#### Substance Use

```{r g8 substab prop test}
df_select_factored |>
 filter(geo_strata == "W non-MSA") |>
ggbarcrosstabs(substab_f,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Patient Substance Use among Visits within West non-MSA",
    x="History of Substance Use",
    y="Proportion of Visits"
    ) -> plot_bar_cross_substab_g8
plot_bar_cross_substab_g8
```

#### Opioids

```{r g8 rx_opioid prop test}
df_select_factored |>
 filter(geo_strata == "W non-MSA") |>
ggbarcrosstabs(rx_opioid,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Opioid Prescribing within West non-MSA",
    x="Opioid Medication Given During Visit",
    y="Proportion of Visits"
    ) -> plot_bar_cross_opioid_g8
plot_bar_cross_opioid_g8
```

#### NSAID/Acet

```{r g8 rx_nsaid_ace prop test}
df_select_factored |>
 filter(geo_strata == "W non-MSA") |>
ggbarcrosstabs(rx_nsaid_ace,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="NSAID/Acetaminophen Prescribing within West non-MSA",
    x="NSAID and/or Acetaminophen Given During Visit",
    y="Proportion of Visits"
    ) -> plot_bar_cross_nsaid_g8
plot_bar_cross_nsaid_g8
```

#### Antibiotics

```{r g8 rx_antibiotic prop test}
df_select_factored |>
 filter(geo_strata == "W non-MSA") |>
ggbarcrosstabs(rx_antibiotic,DentalVisit,PATWT,fill=TRUE) +
  scale_fill_brewer(palette="Set2") +
  labs(
    title="Antibiotic Prescribing within West non-MSA",
    x="Antibiotic Given During Visit",
    y="Proportion of Visits"
    ) -> plot_bar_cross_antibiotic_g8
plot_bar_cross_antibiotic_g8
```

## Export OR Tables

```{r}
write_csv(g0_or,"output_g0_or.csv")
write_csv(g1_or,"output_g1_or.csv")
write_csv(g2_or,"output_g2_or.csv")
write_csv(g3_or,"output_g3_or.csv")
write_csv(g4_or,"output_g4_or.csv")
write_csv(g5_or,"output_g5_or.csv")
write_csv(g6_or,"output_g6_or.csv")
write_csv(g7_or,"output_g7_or.csv")
write_csv(g8_or,"output_g8_or.csv")
```
